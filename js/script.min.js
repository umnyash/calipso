"use strict";const DESKTOP_WIDTH_MEDIA_QUERY="(min-width: 1346px)",LAPTOP_WIDTH_MEDIA_QUERY="(min-width: 1260px)",WIDE_TABLET_WIDTH_MEDIA_QUERY="(min-width: 1024px)",CODE_LENGTH=4,BANNERS_AUTOPLAY_DELAY=6e3,KeyCode=Object.freeze({LEFT_ARROW:"ArrowLeft",RIGHT_ARROW:"ArrowRight",DOWN_ARROW:"ArrowDown",UP_ARROW:"ArrowUp",SPACE:"Space",ESCAPE:"Escape"}),pageInnerElement=document.querySelector(".page__inner");function togglePageScroll(){pageInnerElement.classList.toggle("scroll-lock")}function isDownArrowEvent(evt){return evt.code===KeyCode.DOWN_ARROW}function isEscapeEvent(evt){return evt.code===KeyCode.ESCAPE}function isLeftArrowEvent(evt){return evt.code===KeyCode.LEFT_ARROW}function isRightArrowEvent(evt){return evt.code===KeyCode.RIGHT_ARROW}function isSpaceEvent(evt){return evt.code===KeyCode.SPACE}function isUpArrowEvent(evt){return evt.code===KeyCode.UP_ARROW}function createElementByString(template){const newElement=document.createElement("div");return newElement.innerHTML=template,newElement.firstElementChild}function getPaginationButtonCreator(slideName="Слайд"){return(index,className)=>`\n    <button class='${className}' type='button'>\n      <span class='visually-hidden'>${slideName} ${index+1}.</span>\n    </button>\n  `}function debounce(callback,timeoutDelay=500){let timeoutId;return(...rest)=>{clearTimeout(timeoutId),timeoutId=setTimeout((()=>callback.apply(this,rest)),timeoutDelay)}}function throttle(callback,delay){let timeoutId,lastTime=0;return(...rest)=>{const now=new Date;clearTimeout(timeoutId),timeoutId=setTimeout((()=>callback.apply(this,rest)),delay),now-lastTime>=delay&&(callback.apply(this,rest),lastTime=now)}}function getDigitsFromString(string){return string.replace(/\D/g,"")}function showAlert(openModal,alert){const modalElement=createElementByString(`\n    <div class="modal modal--with_alert">\n      <div class="modal__inner">\n        <button class="modal__close-button" type="button">\n          <span class="visually-hidden">Закрыть</span>\n        </button>\n        <section class="alert modal__alert ${"error"===alert.status?"alert--error":""}">\n          <h2 class="alert__heading">${alert.heading}</h2>\n          ${alert.text?`<p class="alert__text">${alert.text}</p>`:""}\n          <button class="button alert__button button--secondary" type="button">${alert.buttonText||"Закрыть"}</button>\n        </section>\n      </div>\n    </div>\n  `);document.body.append(modalElement),openModal(modalElement)}function initAllBrands(allBrandsElement){const searchFormElement=allBrandsElement.querySelector(".all-brands__form"),searchFieldElement=searchFormElement.querySelector(".text-field__control"),clearButtonElement=searchFormElement.querySelector(".text-field__clear-button"),allBrands={};function filterBrandsList(query){for(const title in allBrands){const brands=allBrands[title];let isFind=!1;brands.links.forEach((linkElement=>{linkElement.textContent.toLowerCase().includes(query.toLowerCase())?(linkElement.parentElement.classList.remove("all-brands__item--hidden"),isFind=!0):linkElement.parentElement.classList.add("all-brands__item--hidden")})),isFind?brands.group.classList.remove("all-brands__group--hidden"):brands.group.classList.add("all-brands__group--hidden")}}allBrandsElement.querySelectorAll(".all-brands__group").forEach((groupElement=>{const groupTitle=groupElement.querySelector(".all-brands__group-name").textContent;allBrands[groupTitle]={group:groupElement,links:groupElement.querySelectorAll(".all-brands__link")}})),searchFormElement.addEventListener("submit",(function(evt){evt.preventDefault()})),searchFieldElement.addEventListener("input",(function({target:target}){filterBrandsList(target.value.trim().toLowerCase())})),clearButtonElement.addEventListener("click",(function(evt){evt.preventDefault(),searchFieldElement.value="",filterBrandsList("")}))}async function sendData(url,body,onSuccess=(()=>{}),onFail=(()=>{}),onFinally=(()=>{})){try{const response=await fetch(url,{method:"POST",body:body});if(!response.ok)throw new Error(`${response.status} – ${response.statusText}`);try{onSuccess(await response.json())}catch(err){onSuccess()}}catch(err){onFail()}finally{onFinally()}}function createArticlePreviewTemplate(article,modificators){const date=new Intl.DateTimeFormat("ru",{year:"numeric",month:"long",day:"numeric"}).format(Date.parse(article.date)).replace(/ г.$/,"");return`\n    <li class="article-preview ${modificators||""}">\n      <h3 class="article-preview__heading">\n        <a class="article-preview__link" href="${article.href}">${article.title}</a>\n      </h3>\n      <p class="article-preview__label">${article.type}</p>\n      <picture class="article-preview__image-wrapper">\n        <img class="article-preview__image" src="${article.image}" alt="" loading="lazy"/>\n      </picture>\n      <time class="article-preview__date" datetime="${article.date}">${date}</time>\n    </li>\n  `}function initArticlesSlider(articlesSliderElement){const swiperElement=articlesSliderElement.querySelector(".articles__slider"),prevButtonElement=articlesSliderElement.querySelector(".articles__slider-arrows .slider-arrows__button--prev"),nextButtonElement=articlesSliderElement.querySelector(".articles__slider-arrows .slider-arrows__button--next"),swiper=new Swiper(swiperElement,{slidesPerView:"auto",spaceBetween:15,navigation:{prevEl:prevButtonElement,nextEl:nextButtonElement},breakpoints:{768:{slidesPerView:4,spaceBetween:20},1346:{slidesPerView:4,spaceBetween:30},1900:{slidesPerView:4,spaceBetween:40}}}),filterElement=articlesSliderElement.querySelector(".articles__filter"),slideElements=articlesSliderElement.querySelectorAll(".articles__slider-item");filterElement.addEventListener("change",(evt=>{const tag=evt.target.value;slideElements.forEach((slideElement=>{slideElement.classList.toggle("articles__slider-item--hidden",!(slideElement.dataset.tag===tag||"all"===tag))})),swiper.update()}))}function initBanners(bannersElement){const sliderElement=bannersElement.querySelector(".banners__slider"),thumbnailsSliderElement=bannersElement.querySelector(".banners__thumbnails-slider"),thumbnailsListElement=thumbnailsSliderElement.querySelector(".banners__thumbnails-list"),thumbnailsSwiper=new Swiper(thumbnailsSliderElement,{spaceBetween:5,slidesPerView:"auto",watchSlidesProgress:!0}),bannersSwiper=new Swiper(sliderElement,{effect:"fade",fadeEffect:{crossFade:!0},loop:!0,autoplay:{delay:6e3,disableOnInteraction:!1},thumbs:{swiper:thumbnailsSwiper,slideThumbActiveClass:"banners__thumbnails-item--active"}}),laptopWidthMediaQueryList=window.matchMedia("(min-width: 1260px)");let videoElement=null;const updateProgressBar=throttle((value=>{thumbnailsListElement.style.setProperty("--thumbnail-progress",value)}),25),updateDelayAndPlay=()=>{const videoDurationMs=1e3*videoElement.duration;bannersSwiper.params.autoplay.delay=videoDurationMs,videoElement.currentTime=0,videoElement.play().catch((err=>console.error(err))),bannersSwiper.autoplay.start()};bannersSwiper.on("autoplayTimeLeft",((_s,_time,progress)=>{updateProgressBar(1-progress)}));const onBannersSWiperSlideChange=()=>{if(bannersSwiper.autoplay.stop(),videoElement&&(videoElement.pause(),videoElement.currentTime=0,videoElement.src=videoElement.src),!laptopWidthMediaQueryList.matches)return bannersSwiper.params.autoplay.delay=6e3,void bannersSwiper.autoplay.start();const activeSlideElement=bannersSwiper.slides[bannersSwiper.activeIndex];videoElement=activeSlideElement.querySelector("video"),videoElement?videoElement.readyState>=1?updateDelayAndPlay():videoElement.addEventListener("loadedmetadata",updateDelayAndPlay,{once:!0}):(bannersSwiper.params.autoplay.delay=6e3,bannersSwiper.autoplay.start())};onBannersSWiperSlideChange(),bannersSwiper.on("slideChange",onBannersSWiperSlideChange),laptopWidthMediaQueryList.addEventListener("change",onBannersSWiperSlideChange)}function initButtonPrintPdf(buttonElement){const documentUrl=buttonElement.dataset.url;buttonElement.addEventListener("click",(()=>{buttonElement.disabled=!0,buttonElement.classList.add("document-actions__button--pending");const iframeElement=document.createElement("iframe");iframeElement.style.display="none",iframeElement.addEventListener("load",(()=>{iframeElement.contentWindow.print(),buttonElement.classList.remove("document-actions__button--pending"),buttonElement.disabled=!1})),iframeElement.src=documentUrl,document.body.appendChild(iframeElement)}))}function showCartResult({heading:heading,text:text,buttonText:buttonText,buttonHref:buttonHref}){const cartInnerElement=document.querySelector(".cart__inner");cartInnerElement.querySelector(".cart__heading").remove(),cartInnerElement.querySelector(".cart__form").remove(),cartInnerElement.insertAdjacentHTML("beforeend",`\n    <div class="cart-result">\n      <div class="cart-result__inner container">\n        <h1 class="cart-result__heading heading">${heading}</h1>\n        <p class="cart-result__text">${text}</p>\n        ${buttonHref?`<a class="button cart-result__button button--primary" href="${buttonHref}">${buttonText}</a>`:""}\n      </div>\n    </div>\n  `)}function resetCartForm(){document.querySelector(".cart-form").reset()}class Cart{#pageInnerElement=null;#siteHeaderElement=null;#cartElement=null;#openModal=null;#showAlert=null;#onCartFormSuccessSubmit=null;#onCartFormErrorSubmit=null;#heading=null;#boxElement=null;#cartInnerElement=null;formElement=null;#infoElement=null;#promocodeElement=null;#receivingSectionInnerElement=null;#receivingRadiobuttonsElement=null;#receivingDeliveryGroupElement=null;#receivingPickupGroupElement=null;#chooseAllProductsButtonElement=null;#submitButtonElement=null;#checkoutLinkElement=null;#formCheckoutSection=null;#cartItemElements=null;#pristine=null;constructor({cartElement:cartElement,openModal:openModal,showAlert:showAlert,onCartFormSuccessSubmit:onCartFormSuccessSubmit,onCartFormErrorSubmit:onCartFormErrorSubmit}){this.#cartElement=cartElement,this.#openModal=openModal,this.#showAlert=showAlert,this.#onCartFormSuccessSubmit=onCartFormSuccessSubmit,this.#onCartFormErrorSubmit=onCartFormErrorSubmit,this.formElement=this.#cartElement.querySelector(".cart-form"),this.#heading=this.#cartElement.querySelector(".page-heading .heading")}#sendData=async(url,body,onSuccess,onFail,onFinally)=>{try{const response=await fetch(url,{method:"POST",body:body});if(!response.ok)throw new Error(`${response.status} – ${response.statusText}`);onSuccess(await response.json())}catch(err){onFail(err)}finally{onFinally()}};#goToCheckout=()=>{this.formElement.classList.add("cart-form--checkout"),this.#infoElement.classList.add("cart-form__info--checkout"),this.#heading.textContent="Оформление заказа",this.#cartItemElements.forEach((cartItemElement=>{cartItemElement.querySelector('input[type="checkbox"]').checked?cartItemElement.classList.add("cart-item--checkout"):cartItemElement.parentElement.classList.add("cart-form__products-item--hidden")})),setTimeout((()=>{this.#boxElement.scrollTo({top:this.#formCheckoutSection.offsetTop-this.#siteHeaderElement.offsetHeight,behavior:"smooth"})}),100)};#clearCart=()=>{this.#cartInnerElement.querySelector(".cart__heading").remove(),this.formElement.remove()};showResult=({heading:heading,text:text,buttonText:buttonText,buttonHref:buttonHref})=>{this.#clearCart(),this.#cartInnerElement.insertAdjacentHTML("beforeend",`\n      <div class="cart-result">\n        <div class="cart-result__inner container">\n          <h1 class="cart-result__heading heading">${heading}</h1>\n          <p class="cart-result__text">${text}</p>\n          <a class="button cart-result__button button--primary" href="${buttonHref}">${buttonText}</a>\n        </div>\n      </div>\n    `)};#setValidationTexts(){const nameFieldElement=this.formElement.querySelector(".cart-form__item--name .text-field__control"),phoneFieldElement=this.formElement.querySelector(".cart-form__item--phone .text-field__control"),emailFieldElement=this.formElement.querySelector(".cart-form__item--email .text-field__control"),cityFieldElement=this.formElement.querySelector(".cart-form__item--city .text-field__control"),streetFieldElement=this.formElement.querySelector(".cart-form__item--street .text-field__control"),houseFieldElement=this.formElement.querySelector(".cart-form__item--house .text-field__control");nameFieldElement&&(nameFieldElement.setAttribute("data-pristine-pattern","/^[a-zа-яЁё -]+$/i"),nameFieldElement.dataset.pristineRequiredMessage="Заполните это поле.",nameFieldElement.dataset.pristinePatternMessage="Допустимы только буквы, дефисы и пробелы."),phoneFieldElement&&(phoneFieldElement.dataset.pristineRequiredMessage="Заполните это поле."),emailFieldElement&&(emailFieldElement.dataset.pristineRequiredMessage="Заполните это поле.",emailFieldElement.dataset.pristineEmailMessage="Введите корректный e-mail адрес."),cityFieldElement&&(cityFieldElement.dataset.pristineRequiredMessage="Заполните это поле."),streetFieldElement&&(streetFieldElement.dataset.pristineRequiredMessage="Заполните это поле."),houseFieldElement&&(houseFieldElement.dataset.pristineRequiredMessage="Заполните это поле.")}#initPristine=()=>{this.#pristine=new Pristine(this.formElement,{classTo:"cart-form__item",errorClass:"invalid",errorTextParent:"cart-form__item",errorTextTag:"p",errorTextClass:"prompt-text"})};#toggleCartInfoStickiness=()=>{this.#boxElement.scrollHeight-this.#boxElement.scrollTop===this.#boxElement.clientHeight?this.#infoElement.classList.remove("cart-form__info--sticked"):this.#infoElement.classList.add("cart-form__info--sticked")};#onBoxScroll=throttle(this.#toggleCartInfoStickiness,100);#onWindowResize=throttle(this.#toggleCartInfoStickiness,100);#onFormClick=evt=>{const checkoutLink=evt.target.closest(".cart-form__checkout-link"),promocodeToggleButtonElement=evt.target.closest(".cart-form__promocode-button"),chooseAllProductsButtonElement=evt.target.closest(".cart-form__choose-all-button"),textFieldClearButtonElement=evt.target.closest(".text-field__clear-button"),counterButtonElement=evt.target.closest(".counter__button");if(checkoutLink)return evt.preventDefault(),this.#goToCheckout(),void this.#toggleCartInfoStickiness();if(promocodeToggleButtonElement)this.#promocodeElement.classList.toggle("cart-form__promocode--hidden");else{if(chooseAllProductsButtonElement){const cartItemCheckboxElements=this.formElement.querySelectorAll(".cart-item__checkbox .checker__control");let isButtonActive=chooseAllProductsButtonElement.classList.contains("cart-form__choose-all-button--active");return cartItemCheckboxElements.forEach((checkboxElement=>{checkboxElement.checked=!isButtonActive,checkboxElement.dispatchEvent(new Event("input",{bubbles:!0})),checkboxElement.dispatchEvent(new Event("change",{bubbles:!0}))})),void this.#chooseAllProductsButtonElement.classList.toggle("cart-form__choose-all-button--active",!isButtonActive)}if(textFieldClearButtonElement){const textFieldControlElement=textFieldClearButtonElement.closest(".text-field").querySelector(".text-field__control");return textFieldControlElement.value="",void textFieldControlElement.focus()}if(counterButtonElement){const counterControlElement=counterButtonElement.closest(".counter").querySelector(".counter__control"),counterControlValue=counterControlElement.value;counterButtonElement.classList.contains("counter__button--plus")?counterControlElement.stepUp():counterControlElement.stepDown(),counterControlValue!==counterControlElement.value&&(counterControlElement.dispatchEvent(new Event("input",{bubbles:!0})),counterControlElement.dispatchEvent(new Event("change",{bubbles:!0})))}}};#checkCartItems=()=>{const cartItemCheckboxElements=this.formElement.querySelectorAll(".cart-item__checkbox .checker__control"),checkedCartItems=Array.from(cartItemCheckboxElements).filter((checkboxElement=>checkboxElement.checked)),isAllChecked=cartItemCheckboxElements.length===checkedCartItems.length;this.#chooseAllProductsButtonElement.classList.toggle("cart-form__choose-all-button--active",isAllChecked),this.#checkoutLinkElement.disabled=!checkedCartItems.length};#onFormChange=evt=>{evt.target.closest(".cart-item__checkbox")&&this.#checkCartItems()};#onReceivingRadiobuttonsChange=({target:target})=>{target.closest(".cart-form__receiving-radiobutton--pickup")?(this.#receivingPickupGroupElement.classList.remove("cart-form__section-inner-group--hidden"),this.#receivingDeliveryGroupElement.remove(),this.#initPristine()):(this.#receivingPickupGroupElement.classList.add("cart-form__section-inner-group--hidden"),this.#receivingSectionInnerElement.appendChild(this.#receivingDeliveryGroupElement),this.#initPristine())};#successDefaultCb=()=>{resetCartForm(),showCartResult({heading:"Heading",text:"text",buttonText:"button",buttonHref:"#"})};#errorDefaultCb=()=>{this.#showAlert(this.#openModal,{status:"error",heading:"Ошибка",text:"Текст ошибки."})};#onFormSubmit=evt=>{evt.preventDefault();const isValid=this.#pristine.validate(),actionUrl=this.formElement.getAttribute("action");if(isValid)this.#submitButtonElement.disabled=!0,this.#submitButtonElement.classList.add("button--pending"),this.#sendData(actionUrl,new FormData(evt.target),(data=>{(this.#onCartFormSuccessSubmit??this.#successDefaultCb)(data),this.#pageInnerElement.scrollTo({top:0,behavior:"instant"})}),(err=>{(this.#onCartFormErrorSubmit??this.#errorDefaultCb)(err)}),(()=>{this.#submitButtonElement.disabled=!1,this.#submitButtonElement.classList.remove("button--pending")}));else{const firstInvalidFormItem=this.formElement.querySelector(".invalid");firstInvalidFormItem.querySelector("input").focus(),this.#boxElement.scrollTo({top:firstInvalidFormItem.offsetTop-this.#siteHeaderElement.offsetHeight,behavior:"smooth"})}};initForm(){this.#pageInnerElement=document.querySelector(".page__inner"),this.#siteHeaderElement=document.querySelector(".site-header"),this.#boxElement=document.querySelector(".page__inner"),this.#cartInnerElement=this.#cartElement.querySelector(".cart__inner"),this.#infoElement=this.formElement.querySelector(".cart-form__info"),this.#chooseAllProductsButtonElement=this.formElement.querySelector(".cart-form__choose-all-button"),this.#receivingSectionInnerElement=this.formElement.querySelector(".cart-form__section--receiving .cart-form__section-inner"),this.#receivingRadiobuttonsElement=this.#receivingSectionInnerElement.querySelector(".cart-form__radiobuttons-list--receiving"),this.#receivingDeliveryGroupElement=this.#receivingSectionInnerElement.querySelector(".cart-form__section-inner-group--delivery"),this.#receivingPickupGroupElement=this.#receivingSectionInnerElement.querySelector(".cart-form__section-inner-group--pickup"),this.#promocodeElement=this.#infoElement.querySelector(".cart-form__promocode"),this.#submitButtonElement=this.formElement.querySelector(".cart-form__submit-button"),this.#checkoutLinkElement=this.formElement.querySelector(".cart-form__checkout-link"),this.#formCheckoutSection=this.formElement.querySelector(".cart-form__section--checkout"),this.#cartItemElements=this.formElement.querySelectorAll(".cart-item"),this.#setValidationTexts(),this.#initPristine(),this.formElement.addEventListener("click",this.#onFormClick),this.formElement.addEventListener("change",this.#onFormChange),this.#receivingRadiobuttonsElement.addEventListener("change",this.#onReceivingRadiobuttonsChange),this.formElement.addEventListener("submit",this.#onFormSubmit),this.#boxElement.addEventListener("scroll",this.#onBoxScroll),window.addEventListener("resize",this.#onWindowResize),this.#checkCartItems(),this.#toggleCartInfoStickiness()}}function initCart(cartElement,openModal,showAlert,onCartFormSuccessSubmit,onCartFormErrorSubmit){const cart=new Cart({cartElement:cartElement,openModal:openModal,showAlert:showAlert,onCartFormSuccessSubmit:onCartFormSuccessSubmit,onCartFormErrorSubmit:onCartFormErrorSubmit});return cart.formElement&&cart.initForm(),cart}class CatalogFiltersModal{#inputEvent=new Event("input",{bubbles:!0});#modalElement=null;#initScrollContainer=null;#openModal=null;#toggleFoldState=null;#resetButtonElement=null;#filtersElement=null;#scrollContainerElement=null;#swiper=null;#fieldControlElements=null;constructor({modalElement:modalElement,initScrollContainer:initScrollContainer,openModal:openModal,toggleFoldState:toggleFoldState}){this.#modalElement=modalElement,this.#initScrollContainer=initScrollContainer,this.#openModal=openModal,this.#toggleFoldState=toggleFoldState}#onOpenerClick=evt=>{evt.preventDefault(),this.#openModal(this.#modalElement);const targetFoldName=evt.target.dataset.foldName;if(targetFoldName){const foldButtonElement=this.#filtersElement.querySelector(`[data-fold-name="${targetFoldName}"]`);"true"!==foldButtonElement.ariaExpanded&&this.#toggleFoldState(foldButtonElement);const overHeight=this.#scrollContainerElement.scrollHeight-this.#scrollContainerElement.offsetHeight;if(overHeight>0){const shift=Math.min(overHeight,foldButtonElement.offsetTop);this.#swiper.setTranslate(-shift)}}setTimeout((()=>this.#swiper.update()),300)};#onFiltersClick=evt=>{const boxToggleButtonElement=evt.target.closest(".catalog-filter__box-toggle-button"),foldToggleButtonElement=evt.target.closest(".catalog-filters__folds-button");if(boxToggleButtonElement){boxToggleButtonElement.closest(".catalog-filter__box").classList.toggle("catalog-filter__box--expand"),setTimeout((()=>this.#swiper.update()),300)}else foldToggleButtonElement&&setTimeout((()=>this.#swiper.update()),300)};#setFoldLabel=fieldElement=>{const foldElement=fieldElement.closest(".catalog-filters__folds-item");if(foldElement)if(foldElement.classList.contains("catalog-filters__folds-item--range")){const rangeMinValueFieldElement=foldElement.querySelector('.number-range__field-control[data-range-limit="min"]'),rangeMaxValueFieldElement=foldElement.querySelector('.number-range__field-control[data-range-limit="max"]'),rangeMinValue=rangeMinValueFieldElement.value,rangeMaxValue=rangeMaxValueFieldElement.value,foldValueElement=foldElement.querySelector(".catalog-filters__folds-value-label"),rangeName=foldElement.dataset.rangeName;foldValueElement.textContent=rangeMinValue&&rangeMaxValue?`${rangeName} от ${rangeMinValue} до ${rangeMaxValue}`:rangeMinValue?`${rangeName} от ${rangeMinValue}`:rangeMaxValue?`${rangeName} до ${rangeMaxValue}`:""}else if(foldElement.classList.contains("catalog-filters__folds-item--checkers")){const foldValueElement=foldElement.querySelector(".catalog-filters__folds-value-label"),optionElements=Array.from(foldElement.querySelectorAll(".checker, .color"));foldValueElement.textContent=optionElements.filter((optionElement=>optionElement.querySelector("input").checked)).map((optionElement=>optionElement.querySelector(".checker__label, .color__name").textContent)).join(", ")}};#setFoldLabels=()=>{this.#fieldControlElements.forEach(this.#setFoldLabel)};#onFiltersInput=evt=>{this.#setFoldLabel(evt.target)};#onResetButtonClick=evt=>{evt.preventDefault(),this.#fieldControlElements.forEach((fieldElement=>{switch(fieldElement.type){case"number":case"text":fieldElement.value="";break;case"checkbox":case"radio":fieldElement.checked=!1}})),this.#fieldControlElements.forEach((fieldElement=>{fieldElement.dispatchEvent(this.#inputEvent)}))};init=()=>{this.#filtersElement=this.#modalElement.querySelector(".catalog-filters"),this.#scrollContainerElement=this.#filtersElement.querySelector(".catalog-filters__scroll-container"),this.#swiper=this.#initScrollContainer(this.#scrollContainerElement),this.#fieldControlElements=Array.from(this.#filtersElement.querySelectorAll("input")),this.#resetButtonElement=this.#filtersElement.querySelector(".catalog-filters__reset-button"),this.#setFoldLabels();document.querySelectorAll(".catalog__filter-opener-button").forEach((buttonElement=>{buttonElement.addEventListener("click",this.#onOpenerClick)})),this.#filtersElement.addEventListener("click",this.#onFiltersClick),this.#resetButtonElement.addEventListener("click",this.#onResetButtonClick),this.#filtersElement.addEventListener("input",this.#onFiltersInput)}}function initCatalogFiltersModal(modalElement,initScrollContainer,openModal,toggleFoldState){const catalogFiltersModal=new CatalogFiltersModal({modalElement:modalElement,initScrollContainer:initScrollContainer,openModal:openModal,toggleFoldState:toggleFoldState});return catalogFiltersModal.init(),catalogFiltersModal}function initCatalogSorting(sortingElement){const toggleButtonElement=sortingElement.querySelector(".catalog-sorting__toggle-button"),closeeButtonElement=sortingElement.querySelector(".catalog-sorting__close-button");toggleButtonElement.addEventListener("click",(evt=>{evt.preventDefault(),sortingElement.classList.toggle("catalog-sorting--open")})),closeeButtonElement.addEventListener("click",(evt=>{evt.preventDefault(),sortingElement.classList.remove("catalog-sorting--open")}))}class CitiesModal{#modalElement=null;#initScrollContainer=null;#openModal=null;#formElement=null;#foundCitiesListElement=null;#popularCitiesScrollContainerElement=null;#foundCitiesScrollContainerElement=null;#popularCitiesSwiper=null;#foundCitiesSwiper=null;constructor({modalElement:modalElement,initScrollContainer:initScrollContainer,openModal:openModal}){this.#modalElement=modalElement,this.#initScrollContainer=initScrollContainer,this.#openModal=openModal}open=evt=>{evt.preventDefault();const popup=evt.target.closest(".popup");popup&&popup.remove(),this.#openModal(this.#modalElement),this.#modalElement.querySelector("input").focus()};#onFormClick=evt=>{const textFieldClearButtonElement=evt.target.closest(".text-field__clear-button");if(textFieldClearButtonElement){const textFieldControlElement=textFieldClearButtonElement.closest(".text-field").querySelector(".text-field__control");textFieldControlElement.value="",this.#popularCitiesScrollContainerElement.classList.remove("cities__scroll-container--hidden"),textFieldControlElement.focus()}};init(){this.#formElement=this.#modalElement.querySelector(".cities__form"),this.#foundCitiesListElement=this.#modalElement.querySelector(".cities__list--found"),this.#popularCitiesScrollContainerElement=this.#modalElement.querySelector(".cities__scroll-container--popular"),this.#foundCitiesScrollContainerElement=this.#modalElement.querySelector(".cities__scroll-container--found"),this.#popularCitiesSwiper=this.#initScrollContainer(this.#popularCitiesScrollContainerElement),this.#foundCitiesSwiper=this.#initScrollContainer(this.#foundCitiesScrollContainerElement),this.#formElement.addEventListener("click",this.#onFormClick);new MutationObserver((()=>{this.#popularCitiesSwiper.update(),this.#foundCitiesSwiper.update()})).observe(this.#foundCitiesListElement,{subtree:!0,characterData:!0,attributes:!0,childList:!0}),document.querySelectorAll('[data-modal-opener="cities"]').forEach((openerElement=>{openerElement.addEventListener("click",this.open)}))}}function initCitiesModal(modalElement,initScrollContainer,openModal){const citiesModal=new CitiesModal({modalElement:modalElement,initScrollContainer:initScrollContainer,openModal:openModal});return citiesModal.init(),citiesModal}function initCooperationModal(modalElement,sendData,openModal,closeModal,showAlert,initSimpleModalForm,onCooperationFormSuccessSubmit){initSimpleModalForm(modalElement,sendData,openModal,closeModal,showAlert,{success:{heading:"Спасибо! Ваша заявка успешно отправлена",text:"Наш менеджер свяжется с вами в течении 3 рабочих дней для обсуждения деталей"},error:{status:"error",heading:"Ошибка",text:"Не удалось отправить заявку, попробуйте снова."}},onCooperationFormSuccessSubmit)}function initDateField(fieldElement,setInputDateMask){const fieldControlElement=fieldElement.querySelector(".text-field__control"),toggleButtonElement=fieldElement.querySelector(".text-field__calendar-button");let calendarElement=null;const calendar=new AirDatepicker(fieldElement,{classes:"calendar text-field__calendar",dateFormat:"dd.MM.yyyy",minDate:fieldElement.closest('[data-modal="salon"]')?Date.now():"",navTitles:{classes:"text-field__calendar",days:'MMMM <span class="calendar__title-accent">yyyy</span>',weekends:[0,6]},onSelect({formattedDate:formattedDate}){fieldControlElement.value=formattedDate||"",fieldControlElement.dispatchEvent(new Event("input",{bubbles:!0})),closeCalendar()}});function setCalendarDate(value){value&&calendar.selectDate(value,{updateTime:!1,silent:!0})}function closeCalendar(){calendarElement.classList.remove("text-field__calendar--open"),document.removeEventListener("click",onDocumentClickWhenCalendarOpened),toggleButtonElement.classList.remove("text-field__calendar-button--active")}function toggleCalendar(){calendarElement.classList.contains("text-field__calendar--open")?closeCalendar():(setCalendarDate(formatDateString(fieldControlElement.value)),calendar.setViewDate(formatDateString(fieldControlElement.value)||Date.now()),calendar.setCurrentView("days"),calendarElement.classList.add("text-field__calendar--open"),document.addEventListener("click",onDocumentClickWhenCalendarOpened),toggleButtonElement.classList.add("text-field__calendar-button--active"))}function formatDateString(string){return string.split(".").reverse().join("-")}function onDocumentClickWhenCalendarOpened({target:target}){target.closest(".text-field--date")||target.closest(".calendar__title-accent")||closeCalendar()}calendarElement=fieldElement.querySelector(".text-field__calendar"),fieldControlElement.addEventListener("input",(()=>{if(!fieldControlElement.value)return;const formattedControlValue=formatDateString(fieldControlElement.value);setCalendarDate(formattedControlValue),calendarElement.classList.contains("text-field__calendar--open")&&(calendar.setViewDate(formattedControlValue),calendar.setCurrentView("days"))})),toggleButtonElement.addEventListener("click",(()=>{toggleCalendar()})),fieldControlElement.addEventListener("keydown",(evt=>{isSpaceEvent(evt)&&(evt.preventDefault(),toggleCalendar())})),setInputDateMask(fieldControlElement)}function initDocumentModal(modalElement,openModal){const modalName=modalElement.dataset.modal,headingElement=modalElement.querySelector(".document-modal__heading"),contentElement=modalElement.querySelector(".document-modal__scroll-container-content"),copyButtonElement=modalElement.querySelector(".document-actions__button--copy");headingElement&&contentElement&&copyButtonElement&&copyButtonElement.addEventListener("click",(evt=>{evt.preventDefault();const textToCopy=`${headingElement.textContent} ${contentElement.textContent}`;navigator.clipboard.writeText(textToCopy)})),document.querySelectorAll(`[data-modal-opener="${modalName}"]`).forEach((openerElement=>{openerElement.addEventListener("click",(evt=>{evt.preventDefault(),openModal(modalElement)}))}))}function initFeed(feedElement){const swiperElement=feedElement.querySelector(".swiper"),prevButtonElement=feedElement.querySelector(".slider-arrows__button--prev"),nextButtonElement=feedElement.querySelector(".slider-arrows__button--next");new Swiper(swiperElement,{slidesPerView:"auto",spaceBetween:10,navigation:{prevEl:prevButtonElement,nextEl:nextButtonElement},breakpoints:{1900:{spaceBetween:16}}})}function initFeedbackForm(formElement,sendData,openModal,showAlert,onFeedbackFormSuccessSubmit){const nameFieldElement=formElement.querySelector(".feedback-form__item--name .text-field__control"),emailFieldElement=formElement.querySelector(".feedback-form__item--email .text-field__control"),phoneFieldElement=formElement.querySelector(".feedback-form__item--phone .text-field__control"),commentFieldElement=formElement.querySelector(".feedback-form__item--comment .textarea__control"),submitButtonElement=formElement.querySelector(".feedback-form__submit-button"),actionUrl=formElement.getAttribute("action");nameFieldElement&&(nameFieldElement.pattern=/^[a-zа-яЁё -]+$/i,nameFieldElement.dataset.pristineRequiredMessage="Заполните это поле.",nameFieldElement.dataset.pristinePatternMessage="Допустимы только буквы, дефисы и пробелы."),phoneFieldElement&&(phoneFieldElement.dataset.pristineRequiredMessage="Заполните это поле."),emailFieldElement&&(emailFieldElement.dataset.pristineRequiredMessage="Заполните это поле.",emailFieldElement.dataset.pristineEmailMessage="Введите корректный e-mail адрес."),commentFieldElement&&(commentFieldElement.dataset.pristineRequiredMessage="Заполните это поле.");const pristine=new Pristine(formElement,{classTo:"feedback-form__item",errorClass:"invalid",errorTextParent:"feedback-form__item",errorTextTag:"p",errorTextClass:"prompt-text"});const successCb=onFeedbackFormSuccessSubmit??function(){showAlert(openModal,{heading:"Спасибо за обратную связь!"})};formElement.addEventListener("click",(evt=>{const textFieldClearButtonElement=evt.target.closest(".text-field__clear-button");if(textFieldClearButtonElement){const textFieldControlElement=textFieldClearButtonElement.closest(".text-field").querySelector(".text-field__control");textFieldControlElement.value="",textFieldControlElement.focus()}})),formElement.addEventListener("submit",(evt=>{evt.preventDefault();pristine.validate()?(submitButtonElement.disabled=!0,submitButtonElement.classList.add("button--pending"),sendData(actionUrl,new FormData(evt.target),(data=>{formElement.reset(),successCb(data)}),(()=>{showAlert(openModal,{status:"error",heading:"Ошибка",text:"Не удалось отправить сообщение, попробуйте снова."})}),(()=>{submitButtonElement.disabled=!1,submitButtonElement.classList.remove("button--pending")}))):(formElement.classList.remove("feedback-form--error"),setTimeout((()=>formElement.classList.add("feedback-form--error")),50))}))}function initFeedbackModal(modalElement,sendData,openModal,closeModal,showAlert,initSimpleModalForm,onFeedbackFormSuccessSubmit){initSimpleModalForm(modalElement,sendData,openModal,closeModal,showAlert,{success:{heading:"Заявка успешно отправлена",text:"Наш менеджер свяжется с вами"},error:{status:"error",heading:"Ошибка",text:"Не удалось отправить заявку, попробуйте снова."}},onFeedbackFormSuccessSubmit)}function initFileField(fieldElement){const controlElement=fieldElement.querySelector(".file-field__control");fieldElement.addEventListener("change",(({target:target})=>{fieldElement.classList.toggle("file-field--empty",!target.value)})),fieldElement.addEventListener("click",(({target:target})=>{target.closest(".file-field__reset-button")&&(fieldElement.classList.add("file-field--empty"),controlElement.value="")}))}function initFilterSlider(sliderElement){new Swiper(sliderElement,{slidesPerView:"auto",spaceBetween:10,breakpoints:{1346:{spaceBetween:20}}})}function toggleFoldState(buttonElement){const foldElement=buttonElement.closest(".folds__item"),contentWrapperElement=foldElement.querySelector(".folds__content-wrapper"),contentElementHeight=contentWrapperElement.querySelector(".folds__content").getBoundingClientRect().height;contentWrapperElement.style.height=`${contentElementHeight}px`,setTimeout((()=>{foldElement.classList.toggle("folds__item--open")}),20),buttonElement.ariaExpanded="true"===buttonElement.ariaExpanded?"false":"true"}function initFolds(foldsElement){foldsElement.addEventListener("click",(({target:target})=>{const buttonElement=target.closest(".folds__button");buttonElement&&toggleFoldState(buttonElement)})),foldsElement.addEventListener("transitionend",(({target:target})=>{const foldElement=target.closest(".folds__item");foldElement&&foldElement.classList.contains("folds__item--open")&&target.classList.contains("folds__content-wrapper")&&setTimeout((()=>{target.style.height="auto"}),0)}))}function createGalleryModalTemplate(content){return`\n    <div class="modal modal--with_gallery modal--with_review-gallery">\n      <div class="modal__inner">\n        <button class="modal__close-button" type="button"><span class="visually-hidden">Закрыть</span></button>\n        <div class="gallery modal__gallery">\n          <div class="gallery__inner">\n            <div class="gallery__slider">\n              <ul class="slider-arrows gallery__slider-arrows slider-arrows--with-background">\n                <li class="slider-arrows__item">\n                  <button class="slider-arrows__button slider-arrows__button--prev" type="button"><span class="visually-hidden">Предыдущий</span></button>\n                </li>\n                <li class="slider-arrows__item">\n                  <button class="slider-arrows__button slider-arrows__button--next" type="button"><span class="visually-hidden">Следующий</span></button>\n                </li>\n              </ul>\n              <div class="gallery__slider-wrapper swiper">\n                <ul class="gallery__slider-list swiper-wrapper">\n                  ${content.map((file=>`\n                    <li class="gallery__slider-item swiper-slide">\n                      ${"video"===file.type?`\n                        <div class="video gallery__video">\n                          <video class="video__player" src="${file.src}" playsinline controls></video>\n                          <img class="video__poster" src="${file.posterSrc}" alt="">\n                          <div class="video__play-button-wrapper">\n                            <button class="video__play-button"><span class="visually-hidden">Воспроизвести</span></button>\n                          </div>\n                        </div>\n                      `:`\n                        <picture class="gallery__image-wrapper">\n                          <img class="gallery__image" src="${file.src}" alt="">\n                        </picture>\n                      `}\n                    </li>\n                  `)).join("")}\n                </ul>\n              </div>\n            </div>\n            <div class="gallery__thumbnails-slider">\n              <ul class="slider-arrows gallery__thumbnails-slider-arrows">\n                <li class="slider-arrows__item">\n                  <button class="slider-arrows__button slider-arrows__button--prev" type="button"><span class="visually-hidden">Предыдущий</span></button>\n                </li>\n                <li class="slider-arrows__item">\n                  <button class="slider-arrows__button slider-arrows__button--next" type="button"><span class="visually-hidden">Следующий</span></button>\n                </li>\n              </ul>\n              <div class="gallery__thumbnails-slider-wrapper swiper">\n                <ul class="gallery__thumbnails-slider-list swiper-wrapper">\n                  ${content.map((file=>`\n                    <li class="gallery__thumbnails-slider-item swiper-slide">\n                      ${"video"===file.type?`\n                        <div class="gallery__image-wrapper gallery__image-wrapper--video">\n                          <img class="gallery__thumbnails-image" src="${file.posterSrc}" alt=""/>\n                        </div>\n                      `:`\n                        <picture class="gallery__image-wrapper">\n                          <img class="gallery__thumbnails-image" src="${file.src}" alt=""/>\n                        </picture>\n                      `}\n                    </li>\n                  `)).join("")}\n                </ul>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  `}class GalleryModal{#modalElement=null;#openModal=null;#mainSlider=null;constructor({content:content,openModal:openModal,initGallery:initGallery,initVideo:initVideo}){this.#openModal=openModal,this.#modalElement=createElementByString(createGalleryModalTemplate(content)),document.body.append(this.#modalElement),this.#mainSlider=initGallery(this.#modalElement.querySelector(".gallery")),this.#modalElement.querySelectorAll(".video").forEach(initVideo)}open=(slideNumber=0)=>{this.#mainSlider.slideTo(slideNumber,0),this.#openModal(this.#modalElement)}}function initGallery(productGalleryElement){const sliderElement=productGalleryElement.querySelector(".gallery__slider-wrapper"),prevButtonElement=productGalleryElement.querySelector(".gallery__slider .slider-arrows__button--prev"),nextButtonElement=productGalleryElement.querySelector(".gallery__slider .slider-arrows__button--next"),thumbnailsSliderElement=productGalleryElement.querySelector(".gallery__thumbnails-slider-wrapper"),thumbnailsSliderPrevButtonElement=productGalleryElement.querySelector(".gallery__thumbnails-slider .slider-arrows__button--prev"),thumbnailsSliderNextButtonElement=productGalleryElement.querySelector(".gallery__thumbnails-slider .slider-arrows__button--next"),videoElements=sliderElement.querySelectorAll("video"),thumbnailsSwiper=new Swiper(thumbnailsSliderElement,{spaceBetween:10,watchSlidesProgress:!0,slidesPerView:"auto",breakpoints:{768:{slidesPerView:3},1346:{spaceBetween:20}}});return new Swiper(sliderElement,{effect:"fade",fadeEffect:{crossFade:!0},navigation:{prevEl:[prevButtonElement,thumbnailsSliderPrevButtonElement],nextEl:[nextButtonElement,thumbnailsSliderNextButtonElement]},thumbs:{swiper:thumbnailsSwiper,slideThumbActiveClass:"gallery__thumbnails-slider-item--active"},on:{slideChange:()=>{videoElements.forEach((video=>video.pause()))}}})}function setInputDateMask(inputElement){function formatInputValue(value){const digits=getDigitsFromString(value);let formattedValue="";if(digits.length){const dayNumberFirstDigit=+digits[0];if(dayNumberFirstDigit<=3){if(formattedValue=dayNumberFirstDigit,digits.length>1){const dayNumber=+digits.substring(0,2);formattedValue=0===dayNumber?"01":dayNumber<=31?dayNumber.toString().padStart(2,"0"):31}if(digits.length>2){const monthNumberFirstDigit=+digits[2];if(monthNumberFirstDigit<=1){if(formattedValue=`${formattedValue}.${monthNumberFirstDigit}`,digits.length>3){const dayNumber=digits.substring(0,2),monthNumber=+digits.substring(2,4);formattedValue=0===monthNumber?`${dayNumber}.01`:`${dayNumber}.${monthNumber<=12?monthNumber.toString().padStart(2,"0"):12}`}if(digits.length>4){formattedValue+=`.${digits.substring(4,8)}`}}else{if(formattedValue=`${digits.substring(0,2)}.0${monthNumberFirstDigit}`,digits.length>3){formattedValue+=`.${digits.substring(3,7)}`}}}}else if(formattedValue=`0${dayNumberFirstDigit}`,digits.length>1){const monthNumberFirstDigit=+digits[1];if(monthNumberFirstDigit<=1){if(formattedValue=`${formattedValue}.${monthNumberFirstDigit}`,digits.length>2){const dayNumber=digits.substring(0,1).padStart(2,"0"),monthNumber=+digits.substring(1,3);formattedValue=0===monthNumber?`${dayNumber}.01`:`${dayNumber}.${monthNumber<=12?monthNumber.toString().padStart(2,"0"):12}`}if(digits.length>3){formattedValue+=`.${digits.substring(3,7)}`}}else if(formattedValue=`${formattedValue}.0${monthNumberFirstDigit}`,digits.length>2){formattedValue+=`.${digits.substring(2,6)}`}}}return formattedValue}inputElement.addEventListener("input",(evt=>{(inputElement.value.length===inputElement.selectionStart||evt.data&&/\D/g.test(evt.data))&&(inputElement.value=formatInputValue(inputElement.value))})),inputElement.addEventListener("change",(()=>{inputElement.value=formatInputValue(inputElement.value)}))}function initInstallmentRequestModal(modalElement,sendData,openModal,closeModal,showAlert,initSimpleModalForm,onInstallmentRequestFormSuccessSubmit){initSimpleModalForm(modalElement,sendData,openModal,closeModal,showAlert,{success:{heading:"Заявка успешно отправлена",text:"Наш менеджер свяжется с вами в течении 3 рабочих дней"},error:{status:"error",heading:"Ошибка",text:"Не удалось отправить заявку, попробуйте снова."}},onInstallmentRequestFormSuccessSubmit)}async function initMap(mapElement){const COORDINATES=[44.008906,56.323592],containerElement=mapElement.querySelector(".map__inner");containerElement.classList.remove("map__inner--hidden"),containerElement.style.filter="grayscale(1)",await ymaps3.ready;const{YMap:YMap,YMapDefaultSchemeLayer:YMapDefaultSchemeLayer,YMapMarker:YMapMarker,YMapDefaultFeaturesLayer:YMapDefaultFeaturesLayer}=ymaps3,map=new YMap(containerElement,{location:{center:COORDINATES,zoom:15}});map.addChild(new YMapDefaultSchemeLayer),map.addChild(new YMapDefaultFeaturesLayer);const marker=new YMapMarker({coordinates:COORDINATES},document.querySelector("#map-marker-template").content.querySelector(".map-marker").cloneNode(!0)),timerId=setInterval((()=>{const canvasElement=mapElement.querySelector("canvas");canvasElement&&(clearInterval(timerId),canvasElement.style.filter="grayscale(1)",containerElement.style.filter="",map.addChild(marker))}),1e3)}const MODAL_DISAPPEARANCE_TIME=100,openedModals=[];function openModal(modal){modal.classList.remove("modal--hidden"),openedModals.push(modal),document.addEventListener("keydown",onModalEscapeEvent),document.addEventListener("click",onModalClick),setTimeout((()=>{modal.classList.add("modal--open")}),100)}function closeModal(modal){modal.classList.remove("modal--error"),modal.classList.remove("modal--open"),openedModals.pop(),openedModals.length||(document.removeEventListener("keydown",onModalEscapeEvent),document.removeEventListener("click",onModalClick)),setTimeout((()=>{modal.classList.add("modal--hidden"),modal.querySelectorAll(".video").forEach(resetVideo),(modal.classList.contains("modal--with_alert")||modal.classList.contains("modal--with_review-gallery"))&&modal.remove()}),MODAL_DISAPPEARANCE_TIME)}function onModalEscapeEvent(evt){isEscapeEvent(evt)&&(evt.preventDefault(),closeModal(openedModals[openedModals.length-1]))}function onModalClick({target:target}){(target.classList.contains("modal__close-button")||target.classList.contains("alert__button"))&&closeModal(openedModals[openedModals.length-1])}function initNavigationShortcuts(navigationShortcutsElement){const swiperElement=navigationShortcutsElement.querySelector(".swiper");new Swiper(swiperElement,{slidesPerView:"auto",spaceBetween:10})}function initOneClickModal(modalElement,sendData,openModal,closeModal,showAlert,initSimpleModalForm,onOneClickFormSuccessSubmit){initSimpleModalForm(modalElement,sendData,openModal,closeModal,showAlert,{success:{heading:"Заявка успешно отправлена",text:"Наш менеджер свяжется с вами"},error:{status:"error",heading:"Ошибка",text:"Не удалось отправить заявку, попробуйте снова."}},onOneClickFormSuccessSubmit)}function initOrderCallModal(modalElement,sendData,openModal,closeModal,showAlert,initSimpleModalForm,onOrderCallFormSuccessSubmit){initSimpleModalForm(modalElement,sendData,openModal,closeModal,showAlert,{success:{heading:"Спасибо! Ваш вопрос успешно отправлен",text:"Наш менеджер свяжется с вами в течении 3 рабочих дней"},error:{status:"error",heading:"Ошибка",text:"Не удалось отправить вопрос, попробуйте снова."}},onOrderCallFormSuccessSubmit)}class PhoneChangeModal{#submitButtonPendingStateClass="button--pending";#requestCodeTimeInterval=60;#timer=0;#modalElement=null;#openModal=null;#closeModal=null;#externalPhoneFieldElement=null;#externalPhoneTextElement=null;#codeRequestFormElement=null;#codeRequestFormSubmitButton=null;#codeRequestFormPristine=null;#phoneFieldElement=null;#codeSendingFormElement=null;#codeSendingFormSubmitButton=null;#codeSendingFormPristine=null;#phoneTextElement=null;#codeFieldElement=null;#codeSendingFormFooterElement=null;#resendCodeButtonElement=null;#resendCodeTextElement=null;#resendCodeTextTimerElement=null;#onCodeRequestFormSuccessSubmit=null;#onCodeRequestFormErrorSubmit=null;#onCodeReRequestFormSuccessSubmit=null;#onCodeReRequestFormErrorSubmit=null;#onCodeSendingFormSuccessSubmit=null;#onCodeSendingFormErrorSubmit=null;constructor({modalElement:modalElement,openModal:openModal,closeModal:closeModal}){this.#modalElement=modalElement,this.#openModal=openModal,this.#closeModal=closeModal}setRequestCodeTimeInterval=seconds=>{this.#requestCodeTimeInterval=seconds};close=()=>{this.#closeModal(this.#modalElement)};open=()=>{this.#openModal(this.#modalElement)};setExternalPhone=phoneNumber=>{this.#externalPhoneFieldElement&&(this.#externalPhoneFieldElement.value=phoneNumber),this.#externalPhoneTextElement&&(this.#externalPhoneTextElement.textContent=phoneNumber)};getPhoneFieldValue=()=>this.#phoneFieldElement.value;resetCodeRequestForm=()=>{this.#codeRequestFormElement.reset()};resetCodeSendingForm=()=>{this.#codeSendingFormElement.reset()};sendData=async(url,body,onSuccess,onFail,onFinally)=>{try{const response=await fetch(url,{method:"POST",body:body});if(!response.ok)throw new Error(`${response.status} – ${response.statusText}`);onSuccess(await response.json())}catch(err){onFail(err)}finally{onFinally()}};#setValidationTexts(){this.#phoneFieldElement.dataset.pristineRequiredMessage="Заполните это поле.",this.#codeFieldElement.dataset.pristineRequiredMessage="Заполните это поле."}#initPristine=()=>{this.#codeRequestFormPristine=new Pristine(this.#codeRequestFormElement,{classTo:"modal-form__item",errorClass:"invalid",errorTextParent:"modal-form__item",errorTextTag:"p",errorTextClass:"prompt-text"}),this.#codeSendingFormPristine=new Pristine(this.#codeSendingFormElement,{classTo:"modal-form__item",errorClass:"invalid",errorTextParent:"modal-form__item",errorTextTag:"p",errorTextClass:"prompt-text"})};finishWaitingForResend=()=>{this.#codeSendingFormFooterElement.prepend(this.#resendCodeButtonElement),this.#resendCodeTextElement.remove()};startWaitingForResend=()=>{if(this.#timer<=0){this.#timer=this.#requestCodeTimeInterval,this.#resendCodeTextTimerElement.textContent=this.#timer;const timerId=setInterval((()=>{this.#timer--,this.#resendCodeTextTimerElement.textContent=this.#timer,this.#timer<=0&&(clearInterval(timerId),this.finishWaitingForResend())}),1e3);this.#resendCodeButtonElement.remove(),this.#codeSendingFormFooterElement.prepend(this.#resendCodeTextElement)}};goToCodeRequestForm=()=>{this.#codeRequestFormElement.classList.remove("modal-form__form--hidden"),this.#codeSendingFormElement.classList.add("modal-form__form--hidden")};goToCodeSendingForm=()=>{this.#codeRequestFormElement.classList.add("modal-form__form--hidden"),this.#codeSendingFormElement.classList.remove("modal-form__form--hidden");const formattedPhoneText=this.#phoneFieldElement.value.replace(/[()]/g,"").replace(/-/g," ");this.#phoneTextElement.textContent=formattedPhoneText,this.startWaitingForResend()};#onCodeFieldInput=evt=>{evt.target.value.length>4&&(evt.target.value=evt.target.value.slice(0,4))};#onModalClick=evt=>{const textFieldClearButtonElement=evt.target.closest(".text-field__clear-button"),backButtonElement=evt.target.closest(".modal-form__back-button");if(textFieldClearButtonElement){const textFieldControlElement=textFieldClearButtonElement.closest(".text-field").querySelector(".text-field__control");return textFieldControlElement.value="",void textFieldControlElement.focus()}backButtonElement&&(evt.preventDefault(),this.goToCodeRequestForm())};#onCodeRequestFormSubmit=evt=>{if(evt.preventDefault(),this.#timer>0)this.goToCodeSendingForm();else{const actionUrl=this.#codeRequestFormElement.getAttribute("action");this.#codeRequestFormPristine.validate()?(this.#codeRequestFormSubmitButton.disabled=!0,this.#codeRequestFormSubmitButton.classList.add(this.#submitButtonPendingStateClass),this.sendData(actionUrl,new FormData(evt.target),this.#onCodeRequestFormSuccessSubmit,this.#onCodeRequestFormErrorSubmit,(()=>{this.#codeRequestFormSubmitButton.disabled=!1,this.#codeRequestFormSubmitButton.classList.remove(this.#submitButtonPendingStateClass)}))):(this.#modalElement.classList.remove("modal--error"),setTimeout((()=>this.#modalElement.classList.add("modal--error")),50))}};#onResendCodeButtonClick=evt=>{evt.preventDefault(),this.#resendCodeButtonElement.disabled=!0;const actionUrl=this.#codeRequestFormElement.getAttribute("action");this.sendData(actionUrl,new FormData(this.#codeRequestFormElement),this.#onCodeReRequestFormSuccessSubmit,this.#onCodeReRequestFormErrorSubmit,(()=>{this.#resendCodeButtonElement.disabled=!1}))};#onCodeSendingFormSubmit=evt=>{evt.preventDefault();const actionUrl=this.#codeSendingFormElement.getAttribute("action");this.#codeSendingFormPristine.validate()?(this.#codeSendingFormSubmitButton.disabled=!0,this.#codeSendingFormSubmitButton.classList.add(this.#submitButtonPendingStateClass),this.sendData(actionUrl,new FormData(evt.target),this.#onCodeSendingFormSuccessSubmit,this.#onCodeSendingFormErrorSubmit,(()=>{this.#codeSendingFormSubmitButton.disabled=!1,this.#codeSendingFormSubmitButton.classList.remove(this.#submitButtonPendingStateClass)}))):(this.#modalElement.classList.remove("modal--error"),setTimeout((()=>this.#modalElement.classList.add("modal--error")),50))};#onOpenerElementClick=evt=>{evt.preventDefault(),this.open()};setCodeRequestSubmitHandlers=(onSuccess,onFail)=>{this.#onCodeRequestFormSuccessSubmit=onSuccess,this.#onCodeRequestFormErrorSubmit=onFail};setCodeReRequestSubmitHandlers=(onSuccess,onFail)=>{this.#onCodeReRequestFormSuccessSubmit=onSuccess,this.#onCodeReRequestFormErrorSubmit=onFail};setCodeSendingSubmitHandlers=(onSuccess,onFail)=>{this.#onCodeSendingFormSuccessSubmit=onSuccess,this.#onCodeSendingFormErrorSubmit=onFail};init(){this.#externalPhoneFieldElement=document.querySelector(".profile-form__item--phone .text-field__control"),this.#externalPhoneTextElement=document.querySelector(".account__phone"),this.#codeRequestFormElement=this.#modalElement.querySelector(".modal-form__form--code-request"),this.#codeRequestFormSubmitButton=this.#codeRequestFormElement.querySelector(".modal-form__submit-button"),this.#phoneFieldElement=this.#codeRequestFormElement.querySelector(".modal-form__item--tel .text-field__control"),this.#codeSendingFormElement=this.#modalElement.querySelector(".modal-form__form--code-sending"),this.#codeSendingFormSubmitButton=this.#codeSendingFormElement.querySelector(".modal-form__submit-button"),this.#phoneTextElement=this.#codeSendingFormElement.querySelector(".modal-form__phone-text"),this.#codeFieldElement=this.#codeSendingFormElement.querySelector(".modal-form__item--code .text-field__control"),this.#codeSendingFormFooterElement=this.#codeSendingFormElement.querySelector(".modal-form__footer"),this.#resendCodeButtonElement=this.#codeSendingFormElement.querySelector(".modal-form__footer-button--resend-code"),this.#resendCodeTextElement=this.#codeSendingFormElement.querySelector(".modal-form__footer-text--resend-code"),this.#resendCodeTextTimerElement=this.#resendCodeTextElement.querySelector(".modal-form__footer-text-timer"),this.#setValidationTexts(),this.#initPristine(),this.#codeFieldElement.addEventListener("input",this.#onCodeFieldInput),this.#modalElement.addEventListener("click",this.#onModalClick),this.#codeRequestFormElement.addEventListener("submit",this.#onCodeRequestFormSubmit),this.#codeSendingFormElement.addEventListener("submit",this.#onCodeSendingFormSubmit),this.#resendCodeButtonElement.addEventListener("click",this.#onResendCodeButtonClick),document.querySelectorAll('[data-modal-opener="phone-change"]').forEach((openerElement=>{openerElement.addEventListener("click",this.#onOpenerElementClick)}))}}function initPhoneChangeModal(modalElement,openModal,closeModal){const phoneChangeModal=new PhoneChangeModal({modalElement:modalElement,openModal:openModal,closeModal:closeModal});return phoneChangeModal.init(),phoneChangeModal}function initPopupsClosing(){document.addEventListener("click",(evt=>{if(evt.target.matches(".popup__button.button--primary")||evt.target.matches(".popup__close-button")){evt.preventDefault();const popupElement=evt.target.closest(".popup");popupElement.classList.add("popup--closing"),setTimeout((()=>{popupElement.remove()}),300)}}))}function initPremiumBrandsSlider(sliderElement){const swiperElement=sliderElement.querySelector(".swiper"),prevButtonElement=sliderElement.querySelector(".slider-arrows__button--prev"),nextButtonElement=sliderElement.querySelector(".slider-arrows__button--next");new Swiper(swiperElement,{slidesPerView:"auto",loop:!0,navigation:{prevEl:prevButtonElement,nextEl:nextButtonElement}})}function createProductCardTemplate(product,modificators){const priceFormatter=new Intl.NumberFormat("ru");let label,price=null,oldPrice=null;switch(product.discount?(oldPrice=priceFormatter.format(product.price),price=priceFormatter.format(product.price*(100-product.discount)/100)):price=priceFormatter.format(product.price),product.status){case"in-stock":label='<p class="product-card__label product-card__label--in-stock">В наличии</p>';break;case"arrival-expected":label='<p class="product-card__label product-card__label--arrival-expected">Ожидает поступления</p>';break;case"to-order":label='<p class="product-card__label product-card__label--to-order">Под заказ</p>'}return`\n    <article class="product-card product-card-popup__card ${modificators||""}">\n      <div class="product-card__heading-and-signs">\n        <h3 class="product-card__heading">\n          <a class="product-card__link" href="${product.href}">${product.title}</a>\n        </h3>\n        ${product.dimensions?`<p class="product-card__signs">${product.dimensions}</p>`:""}\n      </div>\n      ${product.price?`\n        <div class="product-card__prices">\n          <p class="product-card__price ${product.discount?"accent":""}">${price} ₽</p>\n          ${product.discount?`<s class="product-card__old-price">${oldPrice} ₽</s><p class="producr-card__discount">-${product.discount}%</p>`:""}\n        </div>\n      `:""}\n      <a class="product-card__slider swiper" href="${product.href}">\n        <ul class="product-card__slider-list swiper-wrapper">\n          ${product.images.map(((image,index)=>`\n            <li class="product-card__slider-item swiper-slide">\n              <img class="product-card__image" src="${image}" alt="" loading="lazy"/>\n            </li>\n          `)).join("")}\n        </ul>\n        <p class="product-card__slider-pagination"></p>\n      </a>\n      <div class="product-card__labels-wrapper">\n        <div class="product-card__labels">\n          ${product.isPremium?'<p class="product-card__premium-label"><span class="product-card__premium-label-text">Premium</span></p>':""}\n          ${label||""}\n          <p class="product-card__like-button-wrapper">\n            <button class="like-button product-card__like-button ${product.isFavorite?"like-button--active":""}" type="button" data-id="${product.id}">\n              <span class="visually-hidden">Нравится</span>\n            </button>\n          </p>\n        </div>\n      </div>\n      <a class="product-card__brand" href="${product.brandHref}">\n        Бренд <span class="product-card__brand-name">${product.brand}</span>\n      </a>\n    </article>\n  `}function initProductCard(productCardElement){const sliderElement=productCardElement.querySelector(".product-card__slider"),paginationElement=sliderElement.querySelector(".product-card__slider-pagination");new Swiper(sliderElement,{pagination:{el:paginationElement,bulletClass:"product-card__slider-pagination-button",bulletActiveClass:"product-card__slider-pagination-button--current",renderBullet:getPaginationButtonCreator()}})}function initProductHeaderStickyActionButtons(buttonsWrapperElement){const box=document.querySelector(".page__inner"),onBoxScroll=()=>{box.scrollHeight-box.scrollTop===box.clientHeight?buttonsWrapperElement.classList.remove("product-header__action-buttons--sticked"):buttonsWrapperElement.classList.add("product-header__action-buttons--sticked")};box.addEventListener("scroll",throttle(onBoxScroll,100)),window.addEventListener("resize",throttle(onBoxScroll,100)),onBoxScroll()}function setSliderMode(slider,params){slider.itself.classList.add(slider.modeClass,"swiper"),slider.list.classList.add("swiper-wrapper"),slider.slides.forEach((row=>row.classList.add("swiper-slide"))),slider.swiper=new Swiper(slider.itself,params)}function setSliderSimpleMode(slider){setSliderMode(slider,{pagination:{el:slider.pagination,bulletClass:"product-images__slider-pagination-button",bulletActiveClass:"product-images__slider-pagination-button--current",renderBullet:getPaginationButtonCreator()},grabCursor:!0})}function resetSliderMode(slider){slider?.swiper?.destroy(!0,!0),slider.itself.classList.remove("swiper"),slider.list.classList.remove("swiper-wrapper"),slider.slides.forEach((slide=>{slide.removeAttribute("aria-label"),slide.removeAttribute("role"),slide.classList.remove("swiper-slide")})),slider.list.removeAttribute("aria-live"),slider.pagination.innerHTML="",slider.swiper=null}function initProductImages(productImagesElement){const slider={itself:productImagesElement.querySelector(".product-images__slider"),list:productImagesElement.querySelector(".product-images__slider-list"),slides:productImagesElement.querySelectorAll(".product-images__slider-item"),pagination:productImagesElement.querySelector(".product-images__slider-pagination")},desktopWidthMediaQueryList=window.matchMedia("(min-width: 1346px)"),toggleSliderMode=()=>{desktopWidthMediaQueryList.matches?resetSliderMode(slider):setSliderSimpleMode(slider)};desktopWidthMediaQueryList.addEventListener("change",(()=>{toggleSliderMode()})),toggleSliderMode()}function initProductQuestionModal(modalElement,sendData,openModal,closeModal,showAlert,initSimpleModalForm,onProductQuestionFormSuccessSubmit){initSimpleModalForm(modalElement,sendData,openModal,closeModal,showAlert,{success:{heading:"Ваш вопрос успешно отправлен",text:"Наш менеджер свяжется с вами"},error:{status:"error",heading:"Ошибка",text:"Не удалось отправить вопрос, попробуйте снова."}},onProductQuestionFormSuccessSubmit)}function initProducts(productsElement){const swiperElement=productsElement.querySelector(".swiper"),prevButtonElement=productsElement.querySelector(".slider-arrows__button--prev"),nextButtonElement=productsElement.querySelector(".slider-arrows__button--next");new Swiper(swiperElement,{slidesPerView:"auto",spaceBetween:15,navigation:{prevEl:prevButtonElement,nextEl:nextButtonElement},breakpoints:{768:{spaceBetween:20},1346:{spaceBetween:30},1900:{spaceBetween:40}}})}function initProfileForm(formElement,sendData,openModal,showAlert,onProfileFormSuccessSubmit){const nameFieldElement=formElement.querySelector(".profile-form__item--name .text-field__control"),surnameFieldElement=formElement.querySelector(".profile-form__item--surname .text-field__control"),patronymicFieldElement=formElement.querySelector(".profile-form__item--patronymic .text-field__control"),emailFieldElement=formElement.querySelector(".profile-form__item--email .text-field__control"),dateFieldElement=formElement.querySelector(".profile-form__item--date .text-field__control"),cityFieldElement=formElement.querySelector(".profile-form__item--city .text-field__control"),streetFieldElement=formElement.querySelector(".profile-form__item--street .text-field__control"),houseFieldElement=formElement.querySelector(".profile-form__item--house .text-field__control"),submitButtonElement=formElement.querySelector(".profile-form__submit-button"),actionUrl=formElement.getAttribute("action");function getAllFieldValues(){const values=[];return formElement.querySelectorAll("input").forEach((fieldElement=>{"checkbox"===fieldElement.type?values.push(fieldElement.checked):values.push(fieldElement.value.trim())})),values}nameFieldElement&&(nameFieldElement.setAttribute("data-pristine-pattern","/^[a-zа-яЁё -]+$/i"),nameFieldElement.dataset.pristineRequiredMessage="Заполните это поле.",nameFieldElement.dataset.pristinePatternMessage="Допустимы только буквы, дефисы и пробелы."),surnameFieldElement&&(surnameFieldElement.setAttribute("data-pristine-pattern","/^[a-zа-яЁё -]+$/i"),surnameFieldElement.dataset.pristineRequiredMessage="Заполните это поле.",surnameFieldElement.dataset.pristinePatternMessage="Допустимы только буквы, дефисы и пробелы."),patronymicFieldElement&&(patronymicFieldElement.setAttribute("data-pristine-pattern","/^[a-zа-яЁё -]+$/i"),patronymicFieldElement.dataset.pristineRequiredMessage="Заполните это поле.",patronymicFieldElement.dataset.pristinePatternMessage="Допустимы только буквы, дефисы и пробелы."),emailFieldElement&&(emailFieldElement.dataset.pristineRequiredMessage="Заполните это поле.",emailFieldElement.dataset.pristineEmailMessage="Введите корректный e-mail адрес."),dateFieldElement&&(dateFieldElement.pattern=/^(0[1-9]|[12][0-9]|3[01])\.(0[1-9]|1[0-2])\.\d{4}$/,dateFieldElement.dataset.pristineRequiredMessage="Заполните это поле.",dateFieldElement.dataset.pristinePatternMessage="Введите дату в формате дд.мм.гггг"),cityFieldElement&&(cityFieldElement.dataset.pristineRequiredMessage="Заполните это поле."),streetFieldElement&&(streetFieldElement.dataset.pristineRequiredMessage="Заполните это поле."),houseFieldElement&&(houseFieldElement.dataset.pristineRequiredMessage="Заполните это поле.");let currentFieldValues=getAllFieldValues();const pristine=new Pristine(formElement,{classTo:"profile-form__item",errorClass:"invalid",errorTextParent:"profile-form__item",errorTextTag:"p",errorTextClass:"prompt-text"});formElement.addEventListener("click",(evt=>{const textFieldClearButtonElement=evt.target.closest(".text-field__clear-button");if(textFieldClearButtonElement){const textFieldControlElement=textFieldClearButtonElement.closest(".text-field").querySelector(".text-field__control");textFieldControlElement.value="",textFieldControlElement.focus(),textFieldControlElement.dispatchEvent(new Event("input",{bubbles:!0}))}})),formElement.addEventListener("change",(()=>{formElement.classList.remove("profile-form--error")})),formElement.addEventListener("input",(()=>{submitButtonElement.disabled=!function(){const newValuesString=getAllFieldValues().join();return currentFieldValues.join()!==newValuesString}()}));const successCb=onProfileFormSuccessSubmit??function(){showAlert(openModal,{heading:"Данные успешно обновлены"})};formElement.addEventListener("submit",(evt=>{evt.preventDefault();pristine.validate()?(submitButtonElement.disabled=!0,submitButtonElement.classList.add("button--pending"),sendData(actionUrl,new FormData(evt.target),(data=>{currentFieldValues=getAllFieldValues(),successCb(data)}),(()=>{showAlert(openModal,{status:"error",heading:"Ошибка",text:"Не удалось обновить данные, попробуйте снова."})}),(()=>{submitButtonElement.disabled=!1,submitButtonElement.classList.remove("button--pending")}))):(formElement.classList.remove("profile-form--error"),setTimeout((()=>formElement.classList.add("profile-form--error")),50))}))}function createProductCardPopupTemplate(product,createProductCardTemplate,productCardModificators){return`\n    <div class="product-card-popup pin__popup">\n      <div class="product-card-popup__inner">\n        <button class="product-card-popup__close-button" type="button"><span class="visually-hidden">Закрыть</span></button>\n        ${createProductCardTemplate(product,productCardModificators)}\n        <a class="product-card-popup__link" href="${product.href}">Подробнее</a>\n      </div>\n    </div>\n  `}function closeActivePin(pinElement){const popupEement=pinElement.querySelector(".pin__popup"),buttonElement=pinElement.querySelector(".plus-button");popupEement.classList.add("pin__popup--closing"),setTimeout((()=>{popupEement.remove()}),100),buttonElement.classList.remove("plus-button--active"),pinElement.classList.remove("pin--active")}function closeAllActivePins(pinElements){pinElements.forEach((pinElement=>{pinElement.classList.contains("pin--active")&&closeActivePin(pinElement)}))}function initProject(projectElement,createProductCardTemplate,initProductCard,openModal,showAlert){const pinElements=projectElement.querySelectorAll(".pin");projectElement.addEventListener("click",(evt=>{const pinButtonElement=evt.target.closest(".plus-button"),popupCloseButtonElement=evt.target.closest(".product-card-popup__close-button");if(pinButtonElement){const pinElement=pinButtonElement.closest(".pin");if(pinButtonElement.classList.contains("plus-button--active"))closeActivePin(pinElement);else{closeAllActivePins(pinElements),pinButtonElement.disabled=!0;(async(url,onSuccess,onFail,onFinally)=>{try{const response=await fetch(url);if(!response.ok)throw new Error(`${response.status} – ${response.statusText}`);onSuccess(await response.json())}catch(err){onFail()}finally{onFinally()}})(`/local/ajax/index.php?MODE=loadProjectPicProduct&id=${pinElement.dataset.productId}`,(data=>{const popupElement=createElementByString(createProductCardPopupTemplate(data,createProductCardTemplate,"product-card--popup"));initProductCard(popupElement.querySelector(".product-card")),pinElement.append(popupElement),pinButtonElement.classList.add("plus-button--active"),pinElement.classList.add("pin--active");if(!window.matchMedia("(min-width: 1024px)").matches)return;if(popupElement.getBoundingClientRect().x<100){popupElement.querySelector(".product-card-popup__inner").style.transformOrigin="left bottom",popupElement.style.right="auto",popupElement.style.left="20px"}}),(()=>{showAlert(openModal,{status:"error",heading:"Ошибка",text:"Не удалось загрузить данные товара, попробуйте снова."})}),(()=>{pinButtonElement.disabled=!1}))}}if(popupCloseButtonElement){closeActivePin(popupCloseButtonElement.closest(".pin"))}}))}function initProjectsSlider(sliderElement){const swiperElement=sliderElement.querySelector(".swiper"),prevButtonElement=sliderElement.querySelector(".slider-arrows__button--prev"),nextButtonElement=sliderElement.querySelector(".slider-arrows__button--next");new Swiper(swiperElement,{slidesPerView:"auto",spaceBetween:20,navigation:{prevEl:prevButtonElement,nextEl:nextButtonElement},breakpoints:{1346:{spaceBetween:30},1900:{spaceBetween:40}}})}function initReviewModal(modalElement,sendData,openModal,closeModal,showAlert,initSimpleModalForm,onReviewFormSuccessSubmit){initSimpleModalForm(modalElement,sendData,openModal,closeModal,showAlert,{success:{heading:"Спасибо, что оценили нашу работу",text:"Ваш отзыв будет проверен модератором сайта, и опубликован в течение 2 рабочих дней"},error:{status:"error",heading:"Ошибка",text:"Не удалось отправить отзыв, попробуйте снова."}},onReviewFormSuccessSubmit)}const mockReviewGalleryData=[{type:"video",src:"files/video.mp4",posterSrc:"img/reviews/review-1.webp"},{type:"image",src:"img/reviews/review-1.webp"},{type:"image",src:"img/reviews/review-2.webp"},{type:"image",src:"img/reviews/review-3.webp"},{type:"image",src:"img/reviews/review-1.webp"},{type:"image",src:"img/reviews/review-2.webp"},{type:"image",src:"img/reviews/review-3.webp"}];class ReviewsList{#listElement=null;#galleryModal=null;#initGallery=null;#initVideo=null;#openModal=null;#reviewTextWrapperElements=null;constructor({listElement:listElement,galleryModal:galleryModal,initGallery:initGallery,initVideo:initVideo,openModal:openModal}){this.#listElement=listElement,this.#galleryModal=galleryModal,this.#initGallery=initGallery,this.#initVideo=initVideo,this.#openModal=openModal}updateReviewsTextWrappersList=()=>{this.#reviewTextWrapperElements=this.#listElement.querySelectorAll(".review__text-wrapper")};#setReviewsTextWrappersMode=()=>{this.#reviewTextWrapperElements.forEach((textWrapperElement=>{const isClipped=textWrapperElement.classList.contains("review__text-wrapper--clipped");textWrapperElement.classList.add("review__text-wrapper--clipped");const textElement=textWrapperElement.querySelector(".review__text");textElement.scrollHeight>textElement.offsetHeight?textWrapperElement.classList.add("review__text-wrapper--clippable"):textWrapperElement.classList.remove("review__text-wrapper--clippable"),isClipped||textWrapperElement.classList.remove("review__text-wrapper--clipped")}))};#onWindowResize=throttle(this.#setReviewsTextWrappersMode,500);#onListClick=evt=>{const toggleButtonElement=evt.target.closest(".review__toggle-button"),feedSliderItemElement=evt.target.closest(".feed__slider-item");if(toggleButtonElement){toggleButtonElement.closest(".review__text-wrapper").classList.toggle("review__text-wrapper--clipped")}if(feedSliderItemElement){evt.preventDefault();const feedSliderListElement=feedSliderItemElement.parentElement;feedSliderListElement.classList.add("no-click");const feedSliderItemElementNumber=Array.from(feedSliderListElement.children).indexOf(feedSliderItemElement),review=feedSliderItemElement.closest(".review");new this.#galleryModal({content:reviewsGalleryData[review.dataset.id],openModal:this.#openModal,initGallery:this.#initGallery,initVideo:this.#initVideo}).open(feedSliderItemElementNumber),feedSliderListElement.classList.remove("no-click")}};init=()=>{this.updateReviewsTextWrappersList(),this.#setReviewsTextWrappersMode(),window.addEventListener("resize",this.#onWindowResize),this.#listElement.addEventListener("click",this.#onListClick)}}function initReviewsList(listElement,galleryModal,initGallery,initVideo,openModal){const reviewsList=new ReviewsList({listElement:listElement,galleryModal:galleryModal,initGallery:initGallery,initVideo:initVideo,openModal:openModal});return reviewsList.init(),reviewsList}function initSalonModal(modalElement,sendData,openModal,closeModal,showAlert,initSimpleModalForm,onSalonFormSuccessSubmit){initSimpleModalForm(modalElement,sendData,openModal,closeModal,showAlert,{success:{heading:"Заявка успешно отправлена",text:"Наш менеджер свяжется с вами"},error:{status:"error",heading:"Ошибка",text:"Не удалось отправить заявку, попробуйте снова."}},onSalonFormSuccessSubmit)}function initScrollContainer(containerElement){const scrollbarElement=containerElement.querySelector(".swiper-scrollbar");return new Swiper(containerElement,{direction:"vertical",slidesPerView:"auto",freeMode:!0,autoHeight:!0,scrollbar:{el:scrollbarElement,draggable:!0},mousewheel:!0})}function initSearchFormWithSubmitButton(formElement){const fieldElement=formElement.querySelector(".text-field__control"),submitButtonElement=formElement.querySelector(".search-form__submit-button");fieldElement.addEventListener("input",(evt=>{submitButtonElement.disabled=0===evt.target.value.length})),submitButtonElement.disabled=0===fieldElement.value.length}class SearchModal{#maxListItemsCount=4;#modalElement=null;#openModal=null;#modalContentElement=null;#controlElement=null;#formElement=null;#resultElement=null;#createProductCardTemplate=null;#initProductCard=null;#createArticlePreviewTemplate=null;constructor({modalElement:modalElement,openModal:openModal,createProductCardTemplate:createProductCardTemplate,initProductCard:initProductCard,createArticlePreviewTemplate:createArticlePreviewTemplate}){this.#modalElement=modalElement,this.#openModal=openModal,this.#createProductCardTemplate=createProductCardTemplate,this.#initProductCard=initProductCard,this.#createArticlePreviewTemplate=createArticlePreviewTemplate}#sendData=async(url,body,onSuccess,onFail)=>{try{const response=await fetch(url,{method:"POST",body:body});if(!response.ok)throw new Error(`${response.status} – ${response.statusText}`);onSuccess(await response.json())}catch(err){onFail()}};#onModalClick=evt=>{const clearButton=evt.target.closest(".text-field__clear-button"),popularLink=evt.target.closest(".search-modal__popular-list-link");clearButton&&(this.#controlElement.value="",this.#controlElement.focus(),this.#controlElement.dispatchEvent(new Event("input",{bubbles:!0}))),popularLink&&(this.#controlElement.value=popularLink.textContent,this.#controlElement.focus(),this.#controlElement.dispatchEvent(new Event("input",{bubbles:!0})))};#createResultGroupTemplate(groupTitle,moreResultsLinkHref,list){return`\n      <section class="search-modal__result-group">\n        <header class="search-modal__result-group-header">\n          <h3 class="search-modal__result-group-heading">По вашему запросу найдены «${groupTitle}»</h3>\n          ${moreResultsLinkHref?`\n      <a class="search-modal__result-group__link link link--small" href="${moreResultsLinkHref}">Ещё результаты</a>\n    `:""}\n        </header>\n        ${list}\n      </section>\n    `}#showSearchResults=()=>{if(this.#controlElement.value.trim().length<3)return this.#modalContentElement.classList.remove("search-modal--with-result"),void(this.#resultElement.innerHTML="");this.#modalContentElement.classList.add("search-modal--with-result");const actionUrl=this.#formElement.getAttribute("action");this.#sendData(actionUrl,new FormData(this.#formElement),(data=>{this.#resultElement.innerHTML="";const searchResult=data;if(searchResult?.products?.length||searchResult?.articles?.length){if(searchResult?.products?.length){const productsListTemplate=`\n            <ul class="products-list products-list--size_xs search-modal__result-group-list">\n              ${searchResult.products.slice(0,this.#maxListItemsCount).map((product=>this.#createProductCardTemplate(product,"product-card--size_xs"))).join("")}\n            </ul>\n          `,moreResultsLinkHref=searchResult.products.length>this.#maxListItemsCount?`/search/?q=${this.#controlElement.value.trim()}`:null,resultGroupElement=createElementByString(this.#createResultGroupTemplate("Товары",moreResultsLinkHref,productsListTemplate));resultGroupElement.querySelectorAll(".product-card").forEach(this.#initProductCard),this.#resultElement.append(resultGroupElement)}if(searchResult?.articles?.length){const articlesListTemplate=`\n            <ul class="articles-list articles-list--size_s search-modal__result-group-list">\n              ${searchResult.articles.map((article=>this.#createArticlePreviewTemplate(article,"article-preview--size_s"))).join("")}\n            </ul>\n          `,moreResultsLinkHref=searchResult.articles.length>this.#maxListItemsCount?`/search_articles/?q=${this.#controlElement.value.trim()}`:null,resultGroupElement=createElementByString(this.#createResultGroupTemplate("Статьи",moreResultsLinkHref,articlesListTemplate));this.#resultElement.append(resultGroupElement)}}else this.#resultElement.insertAdjacentHTML("beforeend",'<p class="search-modal__result-placeholder">По вашему запросу ничего не найдено</p>')}),(()=>{this.#resultElement.innerHTML="",this.#resultElement.insertAdjacentHTML("beforeend",'<p class="search-modal__result-placeholder search-modal__result-placeholder--error">Ошибка. Не удалось произвести поиск.</p>')}))};#onControlInput=debounce(this.#showSearchResults,500);open=evt=>{evt.preventDefault(),this.#openModal(this.#modalElement),this.#modalElement.querySelector("input").focus()};init=()=>{this.#modalContentElement=this.#modalElement.querySelector(".search-modal"),this.#formElement=this.#modalContentElement.querySelector(".search-modal__form"),this.#controlElement=this.#formElement.querySelector(".text-field__control"),this.#resultElement=this.#modalContentElement.querySelector(".search-modal__result"),document.querySelectorAll('[data-modal-opener="search"]').forEach((openerElement=>{openerElement.addEventListener("click",this.open)})),this.#modalContentElement.addEventListener("click",this.#onModalClick),this.#controlElement.addEventListener("input",this.#onControlInput)}}function initSearchModal(modalElement,openModal,createProductCardTemplate,initProductCard,createArticlePreviewTemplate){const searchModal=new SearchModal({modalElement:modalElement,openModal:openModal,createProductCardTemplate:createProductCardTemplate,initProductCard:initProductCard,createArticlePreviewTemplate:createArticlePreviewTemplate});return searchModal.init(),searchModal}function initSelectionSlider(sliderElement){const swiperElement=sliderElement.querySelector(".swiper"),prevButtonElement=sliderElement.querySelector(".slider-arrows__button--prev"),nextButtonElement=sliderElement.querySelector(".slider-arrows__button--next");new Swiper(swiperElement,{slidesPerView:"auto",spaceBetween:20,navigation:{prevEl:prevButtonElement,nextEl:nextButtonElement},breakpoints:{1346:{spaceBetween:30},1900:{spaceBetween:40}}})}class SignInModal{#submitButtonPendingStateClass="button--pending";#requestCodeTimeInterval=60;#timer=0;#modalElement=null;#openModal=null;#closeModal=null;#codeRequestFormElement=null;#codeRequestFormSubmitButton=null;#codeRequestFormPristine=null;#phoneFieldElement=null;#codeSendingFormElement=null;#codeSendingFormSubmitButton=null;#codeSendingFormPristine=null;#phoneTextElement=null;#codeFieldElement=null;#codeSendingFormFooterElement=null;#resendCodeButtonElement=null;#resendCodeTextElement=null;#resendCodeTextTimerElement=null;#onCodeRequestFormSuccessSubmit=null;#onCodeRequestFormErrorSubmit=null;#onCodeReRequestFormSuccessSubmit=null;#onCodeReRequestFormErrorSubmit=null;#onCodeSendingFormSuccessSubmit=null;#onCodeSendingFormErrorSubmit=null;constructor({modalElement:modalElement,openModal:openModal,closeModal:closeModal}){this.#modalElement=modalElement,this.#openModal=openModal,this.#closeModal=closeModal}setRequestCodeTimeInterval=seconds=>{this.#requestCodeTimeInterval=seconds};close=()=>{this.#closeModal(this.#modalElement)};open=()=>{this.#openModal(this.#modalElement)};resetCodeRequestForm=()=>{this.#codeRequestFormElement.reset()};resetCodeSendingForm=()=>{this.#codeSendingFormElement.reset()};sendData=async(url,body,onSuccess,onFail,onFinally)=>{try{const response=await fetch(url,{method:"POST",body:body});if(!response.ok)throw new Error(`${response.status} – ${response.statusText}`);onSuccess(await response.json())}catch(err){onFail(err)}finally{onFinally()}};#setValidationTexts(){this.#phoneFieldElement.dataset.pristineRequiredMessage="Заполните это поле.",this.#codeFieldElement.dataset.pristineRequiredMessage="Заполните это поле."}#initPristine=()=>{this.#codeRequestFormPristine=new Pristine(this.#codeRequestFormElement,{classTo:"modal-form__item",errorClass:"invalid",errorTextParent:"modal-form__item",errorTextTag:"p",errorTextClass:"prompt-text"}),this.#codeSendingFormPristine=new Pristine(this.#codeSendingFormElement,{classTo:"modal-form__item",errorClass:"invalid",errorTextParent:"modal-form__item",errorTextTag:"p",errorTextClass:"prompt-text"})};finishWaitingForResend=()=>{this.#codeSendingFormFooterElement.prepend(this.#resendCodeButtonElement),this.#resendCodeTextElement.remove()};startWaitingForResend=()=>{if(this.#timer<=0){this.#timer=this.#requestCodeTimeInterval,this.#resendCodeTextTimerElement.textContent=this.#timer;const timerId=setInterval((()=>{this.#timer--,this.#resendCodeTextTimerElement.textContent=this.#timer,this.#timer<=0&&(clearInterval(timerId),this.finishWaitingForResend())}),1e3);this.#resendCodeButtonElement.remove(),this.#codeSendingFormFooterElement.prepend(this.#resendCodeTextElement)}};goToCodeRequestForm=()=>{this.#codeRequestFormElement.classList.remove("modal-form__form--hidden"),this.#codeSendingFormElement.classList.add("modal-form__form--hidden")};goToCodeSendingForm=()=>{this.#codeRequestFormElement.classList.add("modal-form__form--hidden"),this.#codeSendingFormElement.classList.remove("modal-form__form--hidden");const formattedPhoneText=this.#phoneFieldElement.value.replace(/[()]/g,"").replace(/-/g," ");this.#phoneTextElement.textContent=formattedPhoneText,this.startWaitingForResend()};#onCodeFieldInput=evt=>{evt.target.value.length>4&&(evt.target.value=evt.target.value.slice(0,4))};#onModalClick=evt=>{const textFieldClearButtonElement=evt.target.closest(".text-field__clear-button"),backButtonElement=evt.target.closest(".modal-form__back-button");if(textFieldClearButtonElement){const textFieldControlElement=textFieldClearButtonElement.closest(".text-field").querySelector(".text-field__control");return textFieldControlElement.value="",void textFieldControlElement.focus()}backButtonElement&&(evt.preventDefault(),this.goToCodeRequestForm())};#onCodeRequestFormSubmit=evt=>{if(evt.preventDefault(),this.#timer>0)this.goToCodeSendingForm();else{const actionUrl=this.#codeRequestFormElement.getAttribute("action");this.#codeRequestFormPristine.validate()?(this.#codeRequestFormSubmitButton.disabled=!0,this.#codeRequestFormSubmitButton.classList.add(this.#submitButtonPendingStateClass),this.sendData(actionUrl,new FormData(evt.target),this.#onCodeRequestFormSuccessSubmit,this.#onCodeRequestFormErrorSubmit,(()=>{this.#codeRequestFormSubmitButton.disabled=!1,this.#codeRequestFormSubmitButton.classList.remove(this.#submitButtonPendingStateClass)}))):(this.#modalElement.classList.remove("modal--error"),setTimeout((()=>this.#modalElement.classList.add("modal--error")),50))}};#onResendCodeButtonClick=evt=>{evt.preventDefault(),this.#resendCodeButtonElement.disabled=!0;const actionUrl=this.#codeRequestFormElement.getAttribute("action");this.sendData(actionUrl,new FormData(this.#codeRequestFormElement),this.#onCodeReRequestFormSuccessSubmit,this.#onCodeReRequestFormErrorSubmit,(()=>{this.#resendCodeButtonElement.disabled=!1}))};#onCodeSendingFormSubmit=evt=>{evt.preventDefault();const actionUrl=this.#codeSendingFormElement.getAttribute("action");this.#codeSendingFormPristine.validate()?(this.#codeSendingFormSubmitButton.disabled=!0,this.#codeSendingFormSubmitButton.classList.add(this.#submitButtonPendingStateClass),this.sendData(actionUrl,new FormData(evt.target),this.#onCodeSendingFormSuccessSubmit,this.#onCodeSendingFormErrorSubmit,(()=>{this.#codeSendingFormSubmitButton.disabled=!1,this.#codeSendingFormSubmitButton.classList.remove(this.#submitButtonPendingStateClass)}))):(this.#modalElement.classList.remove("modal--error"),setTimeout((()=>this.#modalElement.classList.add("modal--error")),50))};#onOpenerElementClick=evt=>{evt.preventDefault(),this.open()};setCodeRequestSubmitHandlers=(onSuccess,onFail)=>{this.#onCodeRequestFormSuccessSubmit=onSuccess,this.#onCodeRequestFormErrorSubmit=onFail};setCodeReRequestSubmitHandlers=(onSuccess,onFail)=>{this.#onCodeReRequestFormSuccessSubmit=onSuccess,this.#onCodeReRequestFormErrorSubmit=onFail};setCodeSendingSubmitHandlers=(onSuccess,onFail)=>{this.#onCodeSendingFormSuccessSubmit=onSuccess,this.#onCodeSendingFormErrorSubmit=onFail};init(){this.#codeRequestFormElement=this.#modalElement.querySelector(".modal-form__form--code-request"),this.#codeRequestFormSubmitButton=this.#codeRequestFormElement.querySelector(".modal-form__submit-button"),this.#phoneFieldElement=this.#codeRequestFormElement.querySelector(".modal-form__item--tel .text-field__control"),this.#codeSendingFormElement=this.#modalElement.querySelector(".modal-form__form--code-sending"),this.#codeSendingFormSubmitButton=this.#codeSendingFormElement.querySelector(".modal-form__submit-button"),this.#phoneTextElement=this.#codeSendingFormElement.querySelector(".modal-form__phone-text"),this.#codeFieldElement=this.#codeSendingFormElement.querySelector(".modal-form__item--code .text-field__control"),this.#codeSendingFormFooterElement=this.#codeSendingFormElement.querySelector(".modal-form__footer"),this.#resendCodeButtonElement=this.#codeSendingFormElement.querySelector(".modal-form__footer-button--resend-code"),this.#resendCodeTextElement=this.#codeSendingFormElement.querySelector(".modal-form__footer-text--resend-code"),this.#resendCodeTextTimerElement=this.#resendCodeTextElement.querySelector(".modal-form__footer-text-timer"),this.#setValidationTexts(),this.#initPristine(),this.#codeFieldElement.addEventListener("input",this.#onCodeFieldInput),this.#modalElement.addEventListener("click",this.#onModalClick),this.#codeRequestFormElement.addEventListener("submit",this.#onCodeRequestFormSubmit),this.#codeSendingFormElement.addEventListener("submit",this.#onCodeSendingFormSubmit),this.#resendCodeButtonElement.addEventListener("click",this.#onResendCodeButtonClick),document.querySelectorAll('[data-modal-opener="sign-in"]').forEach((openerElement=>{openerElement.addEventListener("click",this.#onOpenerElementClick)}))}}function initSignInModal(modalElement,openModal,closeModal){const signInModal=new SignInModal({modalElement:modalElement,openModal:openModal,closeModal:closeModal});return signInModal.init(),signInModal}function initSimpleModalForm(modalElement,sendData,openModal,closeModal,showAlert,alert,onFormSuccessSubmit){const modalName=modalElement.dataset.modal,formElement=modalElement.querySelector(".modal__form"),submitButtonElement=formElement.querySelector(".modal-form__submit-button"),nameFieldElement=modalElement.querySelector(".modal-form__item--name .text-field__control"),surnameFieldElement=modalElement.querySelector(".modal-form__item--surname .text-field__control"),patronymicFieldElement=modalElement.querySelector(".modal-form__item--patronymic .text-field__control"),phoneFieldElement=modalElement.querySelector(".modal-form__item--phone .text-field__control"),emailFieldElement=modalElement.querySelector(".modal-form__item--email .text-field__control"),dateFieldElement=modalElement.querySelector(".modal-form__item--date .text-field__control"),commentFieldElement=modalElement.querySelector(".modal-form__item--comment .textarea__control");nameFieldElement&&(nameFieldElement.setAttribute("data-pristine-pattern","/^[a-zа-яЁё -]+$/i"),nameFieldElement.dataset.pristineRequiredMessage="Заполните это поле.",nameFieldElement.dataset.pristinePatternMessage="Допустимы только буквы, дефисы и пробелы."),surnameFieldElement&&(surnameFieldElement.setAttribute("data-pristine-pattern","/^[a-zа-яЁё -]+$/i"),surnameFieldElement.dataset.pristineRequiredMessage="Заполните это поле.",surnameFieldElement.dataset.pristinePatternMessage="Допустимы только буквы, дефисы и пробелы."),patronymicFieldElement&&(patronymicFieldElement.setAttribute("data-pristine-pattern","/^[a-zа-яЁё -]+$/i"),patronymicFieldElement.dataset.pristineRequiredMessage="Заполните это поле.",patronymicFieldElement.dataset.pristinePatternMessage="Допустимы только буквы, дефисы и пробелы."),phoneFieldElement&&(phoneFieldElement.dataset.pristineRequiredMessage="Заполните это поле.",phoneFieldElement.dataset.pristineEmailMessage="Введите корректный номер телефона."),emailFieldElement&&(emailFieldElement.dataset.pristineRequiredMessage="Заполните это поле.",emailFieldElement.dataset.pristineEmailMessage="Введите корректный e-mail адрес."),dateFieldElement&&(dateFieldElement.pattern=/^(0[1-9]|[12][0-9]|3[01])\.(0[1-9]|1[0-2])\.\d{4}$/,dateFieldElement.dataset.pristineRequiredMessage="Заполните это поле.",dateFieldElement.dataset.pristinePatternMessage="Введите дату в формате дд.мм.гггг"),commentFieldElement&&(commentFieldElement.dataset.pristineRequiredMessage="Заполните это поле.");const actionUrl=formElement.getAttribute("action"),pristine=new Pristine(formElement,{classTo:"modal-form__item",errorClass:"invalid",errorTextParent:"modal-form__item",errorTextTag:"p",errorTextClass:"prompt-text"});const successCb=onFormSuccessSubmit??function(){showAlert(openModal,alert.success)};formElement.addEventListener("click",(evt=>{const textFieldClearButtonElement=evt.target.closest(".text-field__clear-button");if(textFieldClearButtonElement){const textFieldControlElement=textFieldClearButtonElement.closest(".text-field").querySelector(".text-field__control");textFieldControlElement.value="",textFieldControlElement.focus()}})),formElement.addEventListener("submit",(evt=>{evt.preventDefault();pristine.validate()?(submitButtonElement.disabled=!0,submitButtonElement.classList.add("button--pending"),sendData(actionUrl,new FormData(evt.target),(data=>{closeModal(modalElement),successCb(data),formElement.reset()}),(()=>{closeModal(modalElement),showAlert(openModal,alert.error)}),(()=>{submitButtonElement.disabled=!1,submitButtonElement.classList.remove("button--pending")}))):(modalElement.classList.remove("modal--error"),setTimeout((()=>modalElement.classList.add("modal--error")),50))})),document.querySelectorAll(`[data-modal-opener="${modalName}"]`).forEach((openerElement=>{openerElement.addEventListener("click",(evt=>{evt.preventDefault(),pristine.reset(),modalElement.classList.remove("modal--error"),openModal(modalElement),modalElement.querySelector("input").focus()}))}))}function initSiteHeader(headerElement){const pageInnerElement=document.querySelector(".page__inner"),toggleButtonElement=headerElement.querySelector(".site-header__menu-button"),navigationElement=headerElement.querySelector(".site-header__navigation"),laptopWidthMediaQueryList=window.matchMedia("(min-width: 1260px)");toggleButtonElement.addEventListener("click",(()=>{toggleButtonElement.classList.toggle("site-header__menu-button--close"),toggleButtonElement.ariaExpanded="true"===toggleButtonElement.ariaExpanded?"false":"true",navigationElement.classList.toggle("site-header__navigation--open"),headerElement.classList.toggle("page__site-header--expand"),togglePageScroll()}));const groupsElement=navigationElement.querySelector(".site-navigation__panels"),backButtonElement=navigationElement.querySelector(".site-navigation__back-button"),titleElement=navigationElement.querySelector(".site-navigation__title");navigationElement.querySelector(".site-navigation__close-button").addEventListener("click",(evt=>{evt.preventDefault(),navigationElement.classList.remove("site-header__navigation--open"),headerElement.classList.remove("page__site-header--expand"),toggleButtonElement.classList.remove("site-header__menu-button--animated"),toggleButtonElement.classList.remove("site-header__menu-button--close"),toggleButtonElement.ariaExpanded="false",pageInnerElement.classList.remove("scroll-lock")}));const firstPanelOpener=navigationElement.querySelector(".site-navigation__top-link--opener");let activePanelElement=null,activePanelOpenerElement=null,openedItemElement=null;function openPanel(panelOpenerElement){const panelElement=groupsElement.querySelector(`#${panelOpenerElement.dataset.panelId}`);panelElement&&(activePanelElement&&closePanel(),openedItemElement&&closeBottomMenu(),titleElement.textContent=panelOpenerElement.textContent,panelOpenerElement.classList.add("site-navigation__top-link--active"),panelElement.classList.add("site-navigation__panel--active"),navigationElement.classList.add("site-navigation--inside"),activePanelElement=panelElement,activePanelOpenerElement=panelOpenerElement)}function closePanel(){activePanelElement.classList.remove("site-navigation__panel--active"),activePanelOpenerElement.classList.remove("site-navigation__top-link--active"),navigationElement.classList.remove("site-navigation--inside"),activePanelElement=null,activePanelOpenerElement=null}function closeBottomMenu(){openedItemElement.classList.remove("site-navigation__item--opened");const adjacentItemElements=openedItemElement.parentElement.children;titleElement.textContent=activePanelOpenerElement?.textContent;for(const itemElement of adjacentItemElements)itemElement!==openedItemElement&&itemElement.classList.remove("site-navigation__item--hidden");openedItemElement=null}!activePanelElement&&laptopWidthMediaQueryList.matches&&openPanel(firstPanelOpener),laptopWidthMediaQueryList.addEventListener("change",(()=>{!activePanelElement&&laptopWidthMediaQueryList.matches&&openPanel(firstPanelOpener)})),navigationElement.addEventListener("click",(evt=>{if(!laptopWidthMediaQueryList.matches){const panelOpenerElement=evt.target.closest(".site-navigation__top-link--opener"),bottomMenuOpenerElement=evt.target.closest(".site-navigation__middle-link--opener");panelOpenerElement&&(evt.preventDefault(),openPanel(panelOpenerElement)),bottomMenuOpenerElement&&(evt.preventDefault(),openedItemElement&&closeBottomMenu(),function(bottomMenuOpenerElement){openedItemElement&&closeBottomMenu();titleElement.textContent=bottomMenuOpenerElement.textContent,openedItemElement=bottomMenuOpenerElement.parentElement;const adjacentItemElements=openedItemElement.parentElement.children;openedItemElement.classList.add("site-navigation__item--opened");for(const itemElement of adjacentItemElements)itemElement!==openedItemElement&&itemElement.classList.add("site-navigation__item--hidden")}(bottomMenuOpenerElement))}})),navigationElement.addEventListener("mouseover",(evt=>{if(laptopWidthMediaQueryList.matches){const panelOpenerElement=evt.target.closest(".site-navigation__top-link--opener");panelOpenerElement&&openPanel(panelOpenerElement)}})),backButtonElement.addEventListener("click",(evt=>{evt.preventDefault(),openedItemElement?closeBottomMenu():activePanelElement&&closePanel()}));let pageScrollY=0;const box=document.querySelector(".page__inner");box.addEventListener("scroll",throttle((()=>{const headerHeight=headerElement.offsetHeight;box.scrollTop>0&&headerElement.classList.add("site-header--sticked"),box.scrollTop>pageScrollY&&box.scrollTop>headerHeight?headerElement.classList.add("page__site-header--hidden"):(headerElement.classList.remove("page__site-header--hidden"),0===box.scrollTop&&headerElement.classList.remove("site-header--sticked")),pageScrollY=box.scrollTop}),100))}function initStaticGalleryModal(modalElement,openModal,initGallery,openerListWrapperElementSelector){const EXCEPTION_ELEMENT_SELECTORS=[".product-images__slider-item--video"],anchorElementsSelector=`ul li${EXCEPTION_ELEMENT_SELECTORS.map((selector=>`:not(${selector})`)).join("")}`,galleryElement=modalElement.querySelector(".modal__gallery");let gallerySlider=null;galleryElement&&(gallerySlider=initGallery(galleryElement)),document.querySelectorAll(openerListWrapperElementSelector).forEach((openerElement=>{const anchorElements=Array.from(openerElement.querySelectorAll(anchorElementsSelector));openerElement.addEventListener("click",(evt=>{const listItemElement=evt.target.closest("li");if(!EXCEPTION_ELEMENT_SELECTORS.some((selector=>listItemElement.matches(selector)))){if(evt.preventDefault(),listItemElement&&gallerySlider){const listItemNumber=anchorElements.indexOf(listItemElement);gallerySlider.slideTo(listItemNumber,0)}openModal(modalElement),gallerySlider&&setTimeout((()=>{gallerySlider.update()}),100)}}))}))}function initSubscriptionForm(formElement,sendData,openModal,showAlert,onSubscriptionFormSuccessSubmit){const emailFieldElement=formElement.querySelector(".subscription__form-item .text-field__control"),submitButtonElement=formElement.querySelector(".subscription__form-submit-button"),actionUrl=formElement.getAttribute("action");emailFieldElement.dataset.pristineRequiredMessage="Заполните это поле.",emailFieldElement.dataset.pristineEmailMessage="Введите корректный e-mail адрес.";const pristine=new Pristine(formElement,{classTo:"subscription__form-item",errorClass:"invalid",errorTextParent:"subscription__form-item",errorTextTag:"p",errorTextClass:"prompt-text"});const successCb=onSubscriptionFormSuccessSubmit??function(){showAlert(openModal,{heading:"Вы подписались"})};formElement.addEventListener("click",(evt=>{const textFieldClearButtonElement=evt.target.closest(".text-field__clear-button");if(textFieldClearButtonElement){const textFieldControlElement=textFieldClearButtonElement.closest(".text-field").querySelector(".text-field__control");textFieldControlElement.value="",textFieldControlElement.focus()}})),formElement.addEventListener("submit",(evt=>{evt.preventDefault();pristine.validate()?(submitButtonElement.disabled=!0,submitButtonElement.classList.add("button--pending"),sendData(actionUrl,new FormData(evt.target),(data=>{formElement.reset(),successCb(data)}),(()=>{showAlert(openModal,{status:"error",heading:"Ошибка",text:"Не удалось подписаться, попробуйте снова."})}),(()=>{submitButtonElement.disabled=!1,submitButtonElement.classList.remove("button--pending")}))):(formElement.classList.remove("subscription__form--error"),setTimeout((()=>formElement.classList.add("subscription__form--error")),50))}))}function initTaber(taber,idPrefix){const listElement=taber.querySelector(".taber__list"),tabElements=Array.from(listElement.querySelectorAll(".taber__tab")),panelElements=taber.querySelectorAll(".taber__panel");listElement.setAttribute("role","tablist"),tabElements.forEach(((tabElement,index)=>{tabElement.role="tab",tabElement.id=`${idPrefix}-tab-${index+1}`,tabElement.tabIndex=-1,tabElement.parentNode.role="presentation"})),panelElements.forEach(((panelElement,index)=>{panelElement.role="tabpanel",panelElement.tabIndex=-1,panelElement.setAttribute("aria-labelledby",tabElements[index].id),panelElement.classList.add("taber__panel--hidden")}));const switchTab=(oldTabElement,newTabElement,isInitialization)=>{if(oldTabElement){oldTabElement.ariaSelected=null,oldTabElement.tabIndex=-1,oldTabElement.classList.remove("taber__tab--active");const oldIndex=tabElements.indexOf(oldTabElement);panelElements[oldIndex].classList.add("taber__panel--hidden")}isInitialization||newTabElement.focus(),newTabElement.tabIndex=0,newTabElement.ariaSelected=!0,newTabElement.classList.add("taber__tab--active");const index=tabElements.indexOf(newTabElement);panelElements[index].classList.remove("taber__panel--hidden")};(()=>{const targetTabHash=window.location.hash,targetTab=tabElements.find((tabElement=>tabElement.hash===targetTabHash));switchTab(null,targetTab||tabElements[0],!0)})(),listElement.addEventListener("click",(evt=>{evt.preventDefault();const tabElement=evt.target.closest(".taber__tab");if(!tabElement)return;const currentTabElement=listElement.querySelector("[aria-selected]");tabElement!==currentTabElement&&switchTab(currentTabElement,tabElement)}));const desktopWidthMediaQueryList=window.matchMedia("(min-width: 1346px)");listElement.addEventListener("keydown",(evt=>{const index=tabElements.indexOf(evt.target);if(taber.classList.contains("taber--vertical")&&desktopWidthMediaQueryList.matches){if(!isDownArrowEvent(evt)&&!isRightArrowEvent(evt)&&!isUpArrowEvent(evt))return;if(evt.preventDefault(),isRightArrowEvent(evt))panelElements[index].focus();else{const newIndex=isUpArrowEvent(evt)?index-1:index+1;if(!tabElements[newIndex])return;switchTab(evt.target,tabElements[newIndex])}}else if(isDownArrowEvent(evt)||isLeftArrowEvent(evt)||isRightArrowEvent(evt))if(evt.preventDefault(),isDownArrowEvent(evt))panelElements[index].focus();else{const newIndex=isLeftArrowEvent(evt)?index-1:index+1;if(!tabElements[newIndex])return;switchTab(evt.target,tabElements[newIndex])}}))}function initTelField(fieldElement){function getInputNumbersValue(input){return input.value.replace(/\D/g,"")}fieldElement.addEventListener("input",(function(evt){const input=evt.target;let fieldNumbersValue=getInputNumbersValue(input),formattedInputValue="";const selectionStart=input.selectionStart;if(!fieldNumbersValue)return void(input.value="");if(input.value.length!==selectionStart)return void(evt.data&&/\D/g.test(evt.data)&&(input.value=fieldNumbersValue));if(!["7","8","9"].includes(fieldNumbersValue[0]))return void(input.value=`+${fieldNumbersValue}`.substring(0,16));"9"===fieldNumbersValue[0]&&(fieldNumbersValue=`7${fieldNumbersValue}`),formattedInputValue=`${"8"===fieldNumbersValue[0]?"8":"+7"} `,fieldNumbersValue.length>1&&(formattedInputValue+=`(${fieldNumbersValue.substring(1,4)}`),fieldNumbersValue.length>=5&&(formattedInputValue+=`) ${fieldNumbersValue.substring(4,7)}`),fieldNumbersValue.length>=8&&(formattedInputValue+=`-${fieldNumbersValue.substring(7,9)}`),fieldNumbersValue.length>=10&&(formattedInputValue+=`-${fieldNumbersValue.substring(9,11)}`),input.value=formattedInputValue})),fieldElement.addEventListener("keydown",(function(evt){const input=evt.target;"Backspace"===evt.code&&1===getInputNumbersValue(input).length&&(input.value="")})),fieldElement.addEventListener("paste",(function(evt){const pasted=evt.clipboardData||window.clipboardData,input=evt.target,fieldNumbersValue=getInputNumbersValue(input);if(pasted){const pastedText=pasted.getData("Text");/\D/g.test(pastedText)&&(input.value=fieldNumbersValue)}}))}function initTextFieldWithList(fieldElement){const controlElement=fieldElement.querySelector(".text-field__control"),listElement=fieldElement.querySelector(".text-field__data-list");function closeDataList(){listElement.classList.remove("text-field__data-list--open"),document.removeEventListener("click",onDataListClick)}function onDataListClick({target:target}){target.closest(".text-field")||closeDataList()}controlElement.addEventListener("click",(()=>{listElement.classList.add("text-field__data-list--open"),document.addEventListener("click",onDataListClick)})),listElement.addEventListener("click",(({target:target})=>{const linkElement=target.closest(".text-field__data-link");linkElement&&(controlElement.value=linkElement.textContent,controlElement.dispatchEvent(new Event("input",{bubbles:!0})),closeDataList())}))}function initUserNavigation(navigtionElement){const toggleButtonElement=document.querySelector(".shortcuts__link--user");function onDocumentClickWhenNavigationOpen({target:target}){target.closest(".user-navigation")||target===toggleButtonElement||closeNavigation()}function closeNavigation(){navigtionElement.classList.remove("site-header__user-navigation--open"),document.removeEventListener("click",onDocumentClickWhenNavigationOpen)}toggleButtonElement.addEventListener("click",(evt=>{toggleButtonElement.dataset.modalOpener||(evt.preventDefault(),navigtionElement.classList.contains("site-header__user-navigation--open")?closeNavigation():(navigtionElement.classList.add("site-header__user-navigation--open"),document.addEventListener("click",onDocumentClickWhenNavigationOpen)))}))}function initVideoModal(modalElement){const playerElement=modalElement.querySelector(".video__player"),posterElement=modalElement.querySelector(".video__poster");document.querySelectorAll('[data-modal-opener="video"').forEach((openerElement=>{openerElement.addEventListener("click",(evt=>{evt.preventDefault(),playerElement.src=openerElement.dataset.videoSrc,posterElement.src=openerElement.dataset.videoPoster,openModal(modalElement)}))}))}function initVideoReiewsSlider(reviewsElement){const swiperElement=reviewsElement.querySelector(".swiper"),prevButtonElement=reviewsElement.querySelector(".slider-arrows__button--prev"),nextButtonElement=reviewsElement.querySelector(".slider-arrows__button--next");new Swiper(swiperElement,{slidesPerView:"auto",spaceBetween:20,navigation:{prevEl:prevButtonElement,nextEl:nextButtonElement},watchSlidesProgress:!0,breakpoints:{1346:{spaceBetween:30},1900:{spaceBetween:40}}})}function initVideo(videoElement){const posterElement=videoElement.querySelector(".video__poster"),playButtonWrapperElement=videoElement.querySelector(".video__play-button-wrapper"),playButtonElement=videoElement.querySelector(".video__play-button"),playerElement=videoElement.querySelector(".video__player");playButtonElement.addEventListener("click",(()=>{playerElement.play(),playButtonWrapperElement.classList.add("video__play-button-wrapper--hidden"),posterElement.classList.add("video__poster--hidden")})),playerElement.addEventListener("ended",(()=>{playButtonWrapperElement.classList.remove("video__play-button-wrapper--hidden"),posterElement.classList.remove("video__poster--hidden")})),playerElement.addEventListener("play",(()=>{document.querySelectorAll("video").forEach((video=>{video!==playerElement&&video.pause()}))}))}function resetVideo(videoElement){const playerElement=videoElement.querySelector(".video__player"),posterElement=videoElement.querySelector(".video__poster"),playButtonWrapperElement=videoElement.querySelector(".video__play-button-wrapper");playerElement.pause(),playerElement.currentTime=0,playButtonWrapperElement.classList.remove("video__play-button-wrapper--hidden"),posterElement.classList.remove("video__poster--hidden")}document.querySelectorAll(".cart").forEach((cartElement=>{initCart(cartElement,openModal,showAlert,"undefined"!=typeof onCartFormSuccessSubmit?onCartFormSuccessSubmit:null,"undefined"!=typeof onCartFormErrorSubmit?onCartFormErrorSubmit:null)})),document.querySelectorAll(".reviews__list").forEach((listElement=>{initReviewsList(listElement,GalleryModal,initGallery,initVideo,openModal)})),document.querySelectorAll(".site-header").forEach(initSiteHeader),document.querySelectorAll(".premium-brands__slider").forEach(initPremiumBrandsSlider),document.querySelectorAll(".selection__slider").forEach(initSelectionSlider),document.querySelectorAll(".taber").forEach(((taber,index)=>{initTaber(taber,`taber-${index+1}`)})),document.querySelectorAll(".filter__slider").forEach(initFilterSlider),document.querySelectorAll(".banners").forEach(initBanners),document.querySelectorAll(".map").forEach(initMap),document.querySelectorAll(".product-card").forEach(initProductCard),document.querySelectorAll(".products").forEach(initProducts),document.querySelectorAll(".articles--with-slider").forEach(initArticlesSlider),document.querySelectorAll(".navigation-shortcuts").forEach(initNavigationShortcuts),document.querySelectorAll(".catalog-sorting").forEach(initCatalogSorting),document.querySelectorAll(".product-images").forEach(initProductImages),document.querySelectorAll(".product-header__action-buttons").forEach(initProductHeaderStickyActionButtons),document.querySelectorAll(".folds").forEach(initFolds),document.querySelectorAll(".text-field--date").forEach((fieldElement=>{initDateField(fieldElement,setInputDateMask)})),document.querySelectorAll(".scroll-container").forEach(initScrollContainer),document.querySelectorAll(".file-field").forEach(initFileField),document.querySelectorAll(".feed").forEach(initFeed),document.querySelectorAll(".video-reviews").forEach(initVideoReiewsSlider),document.querySelectorAll(".video").forEach(initVideo),document.querySelectorAll(".projects-slider").forEach(initProjectsSlider),document.querySelectorAll('input[type="tel"]').forEach(initTelField),document.querySelectorAll(".all-brands").forEach(initAllBrands),document.querySelectorAll(".profile-form").forEach((formElement=>{initProfileForm(formElement,sendData,openModal,showAlert,"undefined"!=typeof onProfileFormSuccessSubmit?onProfileFormSuccessSubmit:null)})),document.querySelectorAll(".feedback-form").forEach((formElement=>{initFeedbackForm(formElement,sendData,openModal,showAlert,"undefined"!=typeof onFeedbackFormSuccessSubmit?onFeedbackFormSuccessSubmit:null)})),document.querySelectorAll(".subscription__form").forEach((formElement=>{initSubscriptionForm(formElement,sendData,openModal,showAlert,"undefined"!=typeof onSubscriptionFormSuccessSubmit?onSubscriptionFormSuccessSubmit:null)})),document.querySelectorAll('[data-modal="cooperation"]').forEach((modalElement=>{initCooperationModal(modalElement,sendData,openModal,closeModal,showAlert,initSimpleModalForm,"undefined"!=typeof onCooperationFormSuccessSubmit?onCooperationFormSuccessSubmit:null)})),document.querySelectorAll('[data-modal="feedback"]').forEach((modalElement=>{initFeedbackModal(modalElement,sendData,openModal,closeModal,showAlert,initSimpleModalForm,"undefined"!=typeof onFeedbackFormSuccessSubmit?onFeedbackFormSuccessSubmit:null)})),document.querySelectorAll('[data-modal="salon"]').forEach((modalElement=>{initSalonModal(modalElement,sendData,openModal,closeModal,showAlert,initSimpleModalForm,"undefined"!=typeof onSalonFormSuccessSubmit?onSalonFormSuccessSubmit:null)})),document.querySelectorAll('[data-modal="installment-request"]').forEach((modalElement=>{initInstallmentRequestModal(modalElement,sendData,openModal,closeModal,showAlert,initSimpleModalForm,"undefined"!=typeof onInstallmentRequestFormSuccessSubmit?onInstallmentRequestFormSuccessSubmit:null)})),document.querySelectorAll('[data-modal="product-question"]').forEach((modalElement=>{initProductQuestionModal(modalElement,sendData,openModal,closeModal,showAlert,initSimpleModalForm,"undefined"!=typeof onProductQuestionFormSuccessSubmit?onProductQuestionFormSuccessSubmit:null)})),document.querySelectorAll('[data-modal="one-click"]').forEach((modalElement=>{initOneClickModal(modalElement,sendData,openModal,closeModal,showAlert,initSimpleModalForm,"undefined"!=typeof onOneClickFormSuccessSubmit?onOneClickFormSuccessSubmit:null)})),document.querySelectorAll('[data-modal="order-call"]').forEach((modalElement=>{initOrderCallModal(modalElement,sendData,openModal,closeModal,showAlert,initSimpleModalForm,"undefined"!=typeof onOrderCallFormSuccessSubmit?onOrderCallFormSuccessSubmit:null)})),document.querySelectorAll('[data-modal="review"]').forEach((modalElement=>{initReviewModal(modalElement,sendData,openModal,closeModal,showAlert,initSimpleModalForm,"undefined"!=typeof onReviewFormSuccessSubmit?onReviewFormSuccessSubmit:null)})),document.querySelectorAll('[data-modal="catalog-filters"]').forEach((modalElement=>{initCatalogFiltersModal(modalElement,initScrollContainer,openModal,toggleFoldState)})),document.querySelectorAll(".modal--with_product-gallery").forEach((modalElement=>{initStaticGalleryModal(modalElement,openModal,initGallery,".product-images__slider")})),document.querySelectorAll(".modal--with_selection-gallery").forEach((modalElement=>{initStaticGalleryModal(modalElement,openModal,initGallery,".selection__slider-list-wrapper")})),document.querySelectorAll('[data-modal$="-document"]').forEach((modalElement=>{initDocumentModal(modalElement,openModal)})),document.querySelectorAll(".project").forEach((projetcElement=>{initProject(projetcElement,createProductCardTemplate,initProductCard,openModal,showAlert)})),document.querySelectorAll('[data-modal="search"]').forEach((modalElement=>{initSearchModal(modalElement,openModal,createProductCardTemplate,initProductCard,createArticlePreviewTemplate)})),document.querySelectorAll(".user-navigation").forEach(initUserNavigation),document.querySelectorAll('[data-modal="cities"]').forEach((modalElement=>{initCitiesModal(modalElement,initScrollContainer,openModal)})),document.querySelectorAll(".document-actions__button--print").forEach(initButtonPrintPdf);const signInModalElement=document.querySelector('[data-modal="sign-in"]');let signInModal;signInModalElement&&(signInModal=initSignInModal(signInModalElement,openModal,closeModal));const phoneChangeModalElement=document.querySelector('[data-modal="phone-change"]');let phoneChangeModal;phoneChangeModalElement&&(phoneChangeModal=initPhoneChangeModal(phoneChangeModalElement,openModal,closeModal)),document.querySelectorAll(".search-form--with-submit-button").forEach(initSearchFormWithSubmitButton),initPopupsClosing(),document.querySelectorAll(".modal--with_video").forEach(initVideoModal);